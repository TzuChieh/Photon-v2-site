\doxysection{math.\+h}
\hypertarget{math_8h_source}{}\label{math_8h_source}\index{Source/Math/math.h@{Source/Math/math.h}}
\mbox{\hyperlink{math_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{constant_8h}{Math/constant.h}}"{}}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{math__fwd_8h}{Math/math\_fwd.h}}"{}}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{math__table_8h}{Math/math\_table.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{utility_8h}{Utility/utility.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{traits_8h}{Utility/traits.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_t_span_8h}{Utility/TSpan.h}}"{}}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ <Common/assertion.h>}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <Common/primitive\_type.h>}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <Common/compiler.h>}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ <Common/math\_basics.h>}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ <cmath>}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ <algorithm>}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ <numeric>}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ <type\_traits>}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ <utility>}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ <limits>}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ <array>}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ <cstdint>}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ <climits>}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ <bit>}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ <concepts>}}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#if\ PH\_COMPILER\_IS\_MSVC}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#include\ <intrin.h>}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\#pragma\ intrinsic(\_BitScanReverse)}}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\#pragma\ intrinsic(\_umul128)}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceph_1_1math}{ph::math}}}
\DoxyCodeLine{00044\ \{}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00047\ \textcolor{keyword}{inline}\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{namespaceph_1_1math_af09fabd051200745fc83ab8e6119be17}{matrix2x2}}(\textcolor{keyword}{const}\ T\ e00,\ \textcolor{keyword}{const}\ T\ e01,\ \textcolor{keyword}{const}\ T\ e10,\ \textcolor{keyword}{const}\ T\ e11)}
\DoxyCodeLine{00048\ \ \ \ \ -\/>\ std::array<std::array<T,\ 2>,\ 2>}
\DoxyCodeLine{00049\ \{}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{00051\ \ \ \ \ \{\{}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \{\{e00,\ e01\}\},}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \{\{e10,\ e11\}\}}
\DoxyCodeLine{00054\ \ \ \ \ \}\};}
\DoxyCodeLine{00055\ \}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00058\ \textcolor{keyword}{inline}\ T\ \mbox{\hyperlink{namespaceph_1_1math_a3d95f12613138cf607ca4b4b0c04ea48}{squared}}(\textcolor{keyword}{const}\ T\ value)}
\DoxyCodeLine{00059\ \{}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keywordflow}{return}\ value\ *\ value;}
\DoxyCodeLine{00061\ \}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \textcolor{comment}{//\ A\ fast,\ without\ sqrt(),\ nearly\ branchless\ method.\ Notice\ that\ Photon\ uses\ y-\/axis\ as\ the\ up/normal\ vector.\ }}
\DoxyCodeLine{00064\ \textcolor{comment}{//\ This\ static\ method\ implements\ the\ y-\/is-\/normal\ version\ which\ is\ different\ from\ the\ original\ paper.}}
\DoxyCodeLine{00065\ \textcolor{comment}{//\ (Reference:\ Frisvad,\ Jeppe\ Revall,\ "{}Building\ an\ Orthonormal\ Basis\ from\ a\ 3D\ Unit\ Vector\ Without\ Normalization"{},\ }}
\DoxyCodeLine{00066\ \textcolor{comment}{//\ Journal\ of\ Graphics\ Tools,\ 2012)}}
\DoxyCodeLine{00067\ \textcolor{comment}{//\ Note:\ This\ method\ seems\ to\ have\ larger\ numerical\ error\ (at\ least\ 10\string^3\ larger\ than\ my\ naive\ method),\ }}
\DoxyCodeLine{00068\ \textcolor{comment}{//\ thus\ it\ is\ not\ used\ currently.}}
\DoxyCodeLine{00069\ \textcolor{comment}{//}}
\DoxyCodeLine{00070\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespaceph_1_1math_a14234263f1191fde0644069273c63a87}{form\_orthonormal\_basis\_frisvad}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classph_1_1math_1_1_t_vector3}{Vector3R}}\&\ unitYaxis,\ \mbox{\hyperlink{classph_1_1math_1_1_t_vector3}{Vector3R}}*\ \textcolor{keyword}{const}\ out\_unitXaxis,\ \mbox{\hyperlink{classph_1_1math_1_1_t_vector3}{Vector3R}}*\ \textcolor{keyword}{const}\ out\_unitZaxis);}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00074\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ std::enable\_if\_t<!std::is\_\textcolor{keywordtype}{float}ing\_po\textcolor{keywordtype}{int}\_v<T>,\ \textcolor{keywordtype}{int}>\ =\ 0>}
\DoxyCodeLine{00075\ \textcolor{keyword}{inline}\ T\ \mbox{\hyperlink{namespaceph_1_1math_a9e5d8a7a977115813ceeba3f0c00cbdb}{clamp}}(\textcolor{keyword}{const}\ T\ value,\ \textcolor{keyword}{const}\ T\ lowerBound,\ \textcolor{keyword}{const}\ T\ upperBound)}
\DoxyCodeLine{00076\ \{}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keywordflow}{return}\ std::min(upperBound,\ std::max(value,\ lowerBound));}
\DoxyCodeLine{00078\ \}}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00084\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ std::enable\_if\_t<std::is\_\textcolor{keywordtype}{float}ing\_po\textcolor{keywordtype}{int}\_v<T>,\ \textcolor{keywordtype}{int}>\ =\ 0>}
\DoxyCodeLine{00085\ \textcolor{keyword}{inline}\ T\ \mbox{\hyperlink{namespaceph_1_1math_a9e5d8a7a977115813ceeba3f0c00cbdb}{clamp}}(\textcolor{keyword}{const}\ T\ value,\ \textcolor{keyword}{const}\ T\ lowerBound,\ \textcolor{keyword}{const}\ T\ upperBound)}
\DoxyCodeLine{00086\ \{}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{comment}{//\ Use\ \`{}fmin`\ \&\ \`{}fmax`\ as\ they\ have\ the\ properties\ we\ want\ (see\ this\ function's\ doc)}}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keywordflow}{return}\ std::fmin(upperBound,\ std::fmax(value,\ lowerBound));}
\DoxyCodeLine{00089\ \}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00093\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00094\ \textcolor{keyword}{inline}\ T\ \mbox{\hyperlink{namespaceph_1_1math_a3b5aeb6bb0f2f3339e033d34fa70a894}{to\_degrees}}(\textcolor{keyword}{const}\ T\ radians)}
\DoxyCodeLine{00095\ \{}
\DoxyCodeLine{00096\ \ \ \ \ \textcolor{keywordflow}{return}\ radians\ *\ (\mbox{\hyperlink{namespaceph_1_1math_1_1constant_a1bb40d89d819a550a57dbdb5bf950ae2}{constant::rcp\_pi<T>}}\ *\ T(180));}
\DoxyCodeLine{00097\ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00101\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00102\ \textcolor{keyword}{inline}\ T\ \mbox{\hyperlink{namespaceph_1_1math_a8d924d614efcdd92fcce816a3f8eebf3}{to\_radians}}(\textcolor{keyword}{const}\ T\ degrees)}
\DoxyCodeLine{00103\ \{}
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{keywordflow}{return}\ degrees\ *\ (\mbox{\hyperlink{namespaceph_1_1math_1_1constant_aeb217ecd643bb14c638c3d0457a031e0}{constant::pi<T>}}\ /\ T(180));}
\DoxyCodeLine{00105\ \}}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00115\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00116\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{namespaceph_1_1math_a7377d0dddd537e4e7a04f98bd8e1114e}{sign}}(\textcolor{keyword}{const}\ T\ value)}
\DoxyCodeLine{00117\ \{}
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0)\ <\ value)\ -\/\ (\textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0)\ >\ value);}
\DoxyCodeLine{00119\ \}}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00128\ \textcolor{comment}{//\ TODO:\ templatize}}
\DoxyCodeLine{00129\ \textcolor{keyword}{inline}\ uint32\ \mbox{\hyperlink{namespaceph_1_1math_a2dd1eb154bffce7df042dbdd88aa161b}{next\_power\_of\_2}}(uint32\ value)}
\DoxyCodeLine{00130\ \{}
\DoxyCodeLine{00131\ \ \ \ \ PH\_ASSERT(value\ <=\ (1UL\ <<\ 31));}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \ \ -\/-\/value;}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \ \ value\ |=\ value\ >>\ 1;}
\DoxyCodeLine{00136\ \ \ \ \ value\ |=\ value\ >>\ 2;}
\DoxyCodeLine{00137\ \ \ \ \ value\ |=\ value\ >>\ 4;}
\DoxyCodeLine{00138\ \ \ \ \ value\ |=\ value\ >>\ 8;}
\DoxyCodeLine{00139\ \ \ \ \ value\ |=\ value\ >>\ 16;}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{keywordflow}{return}\ value\ +\ 1;}
\DoxyCodeLine{00142\ \}}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00148\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00149\ \textcolor{keyword}{inline}\ T\ \mbox{\hyperlink{namespaceph_1_1math_aef693a3af48988419e383d739b935a4b}{log2\_floor}}(\textcolor{keyword}{const}\ T\ value)}
\DoxyCodeLine{00150\ \{}
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}(std::is\_floating\_point\_v<T>)}
\DoxyCodeLine{00152\ \ \ \ \ \{}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ PH\_ASSERT\_GT(value,\ T(0));}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(std::floor(std::log2(value)));}
\DoxyCodeLine{00156\ \ \ \ \ \}}
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00158\ \ \ \ \ \{}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \textcolor{keyword}{constexpr}\ T\ NUM\_BITS\ =\ \textcolor{keyword}{sizeof}(T)\ *\ CHAR\_BIT;}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_assert}(std::is\_integral\_v<T>);}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ PH\_ASSERT\_GT(value,\ T(0));}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \textcolor{preprocessor}{\#if\ PH\_COMPILER\_IS\_MSVC}}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ first1BitFromLeftIndex\ =\ std::numeric\_limits<unsigned\ long>::max();}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}(\textcolor{keyword}{sizeof}(T)\ <=\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}))}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ isIndexSet\ =\ \_BitScanReverse(}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&first1BitFromLeftIndex,\ }
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\textcolor{keyword}{>}(value));}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \ \ PH\_ASSERT\_GT(isIndexSet,\ 0);}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_assert}(\textcolor{keyword}{sizeof}(T)\ <=\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ \_\_int64),}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}size\ of\ T\ is\ too\ large"{}});}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ isIndexSet\ =\ \_BitScanReverse64(}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&first1BitFromLeftIndex,\ }
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\ \_\_int64\textcolor{keyword}{>}(value));}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ PH\_ASSERT\_GT(isIndexSet,\ 0);}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ PH\_ASSERT\_IN\_RANGE\_INCLUSIVE(first1BitFromLeftIndex,\ T(0),\ NUM\_BITS\ -\/\ 1);}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(first1BitFromLeftIndex);}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \textcolor{preprocessor}{\#elif\ PH\_COMPILER\_IS\_CLANG\ ||\ PH\_COMPILER\_IS\_GCC}}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}(\textcolor{keyword}{sizeof}(T)\ <=\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}))}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ numLeftZeros\ =\ \_\_builtin\_clz(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\textcolor{keyword}{>}(value));}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ int)\ *\ CHAR\_BIT\ -\/\ 1\ -\/\ numLeftZeros);}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}(\textcolor{keyword}{sizeof}(T)\ <=\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}))}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ numLeftZeros\ =\ \_\_builtin\_clzl(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\textcolor{keyword}{>}(value));}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ long)\ *\ CHAR\_BIT\ -\/\ 1\ -\/\ numLeftZeros);}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_assert}(\textcolor{keyword}{sizeof}(T)\ <=\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}),}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}size\ of\ T\ is\ too\ large"{}});}
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ numLeftZeros\ =\ \_\_builtin\_clzll(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\textcolor{keyword}{>}(value));}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ long)\ *\ CHAR\_BIT\ -\/\ 1\ -\/\ numLeftZeros);}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00211\ \ \ \ \ \}}
\DoxyCodeLine{00212\ \}}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00219\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ std::enable\_if\_t<std::is\_\textcolor{keywordtype}{float}ing\_po\textcolor{keywordtype}{int}\_v<T>,\ \textcolor{keywordtype}{int}>\ =\ 0>}
\DoxyCodeLine{00220\ \textcolor{keyword}{inline}\ T\ \mbox{\hyperlink{namespaceph_1_1math_a9460c87b6dab3097ee4d084d9b59a604}{fractional\_part}}(\textcolor{keyword}{const}\ T\ value)}
\DoxyCodeLine{00221\ \{}
\DoxyCodeLine{00222\ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}\ integralPart;}
\DoxyCodeLine{00223\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(std::modf(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}\textcolor{keyword}{>}(value),\ \&integralPart));}
\DoxyCodeLine{00224\ \}}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00229\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ std::enable\_if\_t<std::is\_\textcolor{keywordtype}{int}egral\_v<T>,\ \textcolor{keywordtype}{int}>\ =\ 0>}
\DoxyCodeLine{00230\ \textcolor{keyword}{inline}\ T\ \mbox{\hyperlink{namespaceph_1_1math_a48cf078fd719072dfc9c27d67a730c3c}{wrap}}(T\ value,\ \textcolor{keyword}{const}\ T\ lowerBound,\ \textcolor{keyword}{const}\ T\ upperBound)}
\DoxyCodeLine{00231\ \{}
\DoxyCodeLine{00232\ \ \ \ \ PH\_ASSERT\_GE(upperBound,\ lowerBound);}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{keyword}{const}\ T\ rangeSize\ =\ upperBound\ -\/\ lowerBound\ +\ \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1);}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ \ \ \ \ \textcolor{keywordflow}{if}(value\ <\ lowerBound)}
\DoxyCodeLine{00237\ \ \ \ \ \{}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ value\ +=\ rangeSize\ *\ ((lowerBound\ -\/\ value)\ /\ rangeSize\ +\ \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1));}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Possibly\ fail\ if\ <value>\ overflow}}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ PH\_ASSERT\_GE(value,\ lowerBound);}
\DoxyCodeLine{00242\ \ \ \ \ \}}
\DoxyCodeLine{00243\ }
\DoxyCodeLine{00244\ \ \ \ \ \textcolor{keywordflow}{return}\ lowerBound\ +\ (value\ -\/\ lowerBound)\ \%\ rangeSize;}
\DoxyCodeLine{00245\ \}}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00250\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00251\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespaceph_1_1math_a3d787dce79dfdd2614927831c40ab231}{is\_even}}(\textcolor{keyword}{const}\ T\ value)}
\DoxyCodeLine{00252\ \{}
\DoxyCodeLine{00253\ \ \ \ \ \textcolor{keyword}{static\_assert}(std::is\_integral\_v<T>,}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}T\ must\ be\ an\ integer\ type."{}});}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ \ \ \textcolor{keywordflow}{return}\ value\ \%\ 2\ ==\ 0;}
\DoxyCodeLine{00257\ \}}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00262\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00263\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespaceph_1_1math_a00dacdca0d6501e4506f1e80350c6529}{is\_odd}}(\textcolor{keyword}{const}\ T\ value)}
\DoxyCodeLine{00264\ \{}
\DoxyCodeLine{00265\ \ \ \ \ \textcolor{keywordflow}{return}\ !\mbox{\hyperlink{namespaceph_1_1math_a3d787dce79dfdd2614927831c40ab231}{is\_even}}(value);}
\DoxyCodeLine{00266\ \}}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \textcolor{comment}{//\ Checks\ whether\ the\ specified\ vector\ is\ within\ the\ hemisphere\ defined\ by}}
\DoxyCodeLine{00269\ \textcolor{comment}{//\ the\ normal\ vector\ N.\ N\ points\ to\ the\ hemisphere's\ peak,\ i.e.,\ theta\ =\ 0.}}
\DoxyCodeLine{00270\ \textcolor{comment}{//}}
\DoxyCodeLine{00271\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespaceph_1_1math_a885a24bd55e37b45410ec47a89bfb55e}{is\_same\_hemisphere}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classph_1_1math_1_1_t_vector3}{Vector3R}}\&\ vector,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classph_1_1math_1_1_t_vector3}{Vector3R}}\&\ N);}
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00276\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ std::\textcolor{keywordtype}{size\_t}\ N>}
\DoxyCodeLine{00277\ T\ \mbox{\hyperlink{namespaceph_1_1math_a423ca1404e587fb97e03569f02f95861}{summation}}(\textcolor{keyword}{const}\ std::array<T,\ N>\&\ values,\ T\ initialValue\ =\ 0);}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00279\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00280\ T\ \mbox{\hyperlink{namespaceph_1_1math_a423ca1404e587fb97e03569f02f95861}{summation}}(\textcolor{keyword}{const}\ std::vector<T>\&\ values,\ T\ initialValue\ =\ 0);}
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00282\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ std::\textcolor{keywordtype}{size\_t}\ EXTENT\ =\ std::dynamic\_extent>}
\DoxyCodeLine{00283\ T\ \mbox{\hyperlink{namespaceph_1_1math_a423ca1404e587fb97e03569f02f95861}{summation}}(\mbox{\hyperlink{namespaceph_a06c532bb78132f63638ec3ef52d46ff3}{TSpanView<T,\ EXTENT>}}\ values,\ T\ initialValue\ =\ 0);}
\DoxyCodeLine{00285\ }
\DoxyCodeLine{00289\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ std::\textcolor{keywordtype}{size\_t}\ N>}
\DoxyCodeLine{00290\ T\ \mbox{\hyperlink{namespaceph_1_1math_a688dbf6563c86608204cf755dc0be5cd}{product}}(\textcolor{keyword}{const}\ std::array<T,\ N>\&\ values,\ T\ initialValue\ =\ 1);}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00292\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00293\ T\ \mbox{\hyperlink{namespaceph_1_1math_a688dbf6563c86608204cf755dc0be5cd}{product}}(\textcolor{keyword}{const}\ std::vector<T>\&\ values,\ T\ initialValue\ =\ 1);}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00295\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ std::\textcolor{keywordtype}{size\_t}\ EXTENT\ =\ std::dynamic\_extent>}
\DoxyCodeLine{00296\ T\ \mbox{\hyperlink{namespaceph_1_1math_a688dbf6563c86608204cf755dc0be5cd}{product}}(\mbox{\hyperlink{namespaceph_a06c532bb78132f63638ec3ef52d46ff3}{TSpanView<T,\ EXTENT>}}\ values,\ T\ initialValue\ =\ 1);}
\DoxyCodeLine{00298\ }
\DoxyCodeLine{00299\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ NumberType>}
\DoxyCodeLine{00300\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ NumberType\ \mbox{\hyperlink{namespaceph_1_1math_adb4811e9be6e476d37c2db92e3d5a17a}{bytes\_to\_KiB}}(\textcolor{keyword}{const}\ std::size\_t\ numBytes)}
\DoxyCodeLine{00301\ \{}
\DoxyCodeLine{00302\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}NumberType\textcolor{keyword}{>}(numBytes)\ /\ \textcolor{keyword}{static\_cast<}NumberType\textcolor{keyword}{>}(\mbox{\hyperlink{namespaceph_1_1math_1_1constant_aec2814da28a7c9f64c26e54b610e2004}{constant::KiB}});}
\DoxyCodeLine{00303\ \}}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00305\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ NumberType>}
\DoxyCodeLine{00306\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ NumberType\ \mbox{\hyperlink{namespaceph_1_1math_a510bcaf07562b67f8897a55701399305}{bytes\_to\_MiB}}(\textcolor{keyword}{const}\ std::size\_t\ numBytes)}
\DoxyCodeLine{00307\ \{}
\DoxyCodeLine{00308\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}NumberType\textcolor{keyword}{>}(numBytes)\ /\ \textcolor{keyword}{static\_cast<}NumberType\textcolor{keyword}{>}(\mbox{\hyperlink{namespaceph_1_1math_1_1constant_a49ad38be8f3ddda440960e50cb5376db}{constant::MiB}});}
\DoxyCodeLine{00309\ \}}
\DoxyCodeLine{00310\ }
\DoxyCodeLine{00311\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ NumberType>}
\DoxyCodeLine{00312\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ NumberType\ \mbox{\hyperlink{namespaceph_1_1math_a2da02d8fd55ff426905d97c7297a08ad}{bytes\_to\_GiB}}(\textcolor{keyword}{const}\ std::size\_t\ numBytes)}
\DoxyCodeLine{00313\ \{}
\DoxyCodeLine{00314\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}NumberType\textcolor{keyword}{>}(numBytes)\ /\ \textcolor{keyword}{static\_cast<}NumberType\textcolor{keyword}{>}(\mbox{\hyperlink{namespaceph_1_1math_1_1constant_a5bd138de6e1289a88b5cc6109b0c6bda}{constant::GiB}});}
\DoxyCodeLine{00315\ \}}
\DoxyCodeLine{00316\ }
\DoxyCodeLine{00317\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ NumberType>}
\DoxyCodeLine{00318\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ NumberType\ \mbox{\hyperlink{namespaceph_1_1math_a37422f0d5ec9007755a40521c7bbf89d}{bytes\_to\_TiB}}(\textcolor{keyword}{const}\ std::size\_t\ numBytes)}
\DoxyCodeLine{00319\ \{}
\DoxyCodeLine{00320\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}NumberType\textcolor{keyword}{>}(numBytes)\ /\ \textcolor{keyword}{static\_cast<}NumberType\textcolor{keyword}{>}(\mbox{\hyperlink{namespaceph_1_1math_1_1constant_ac0d72c7c9b2610bd4c5b18bd289a48a9}{constant::TiB}});}
\DoxyCodeLine{00321\ \}}
\DoxyCodeLine{00322\ }
\DoxyCodeLine{00323\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ NumberType>}
\DoxyCodeLine{00324\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ NumberType\ \mbox{\hyperlink{namespaceph_1_1math_aabf2fd737aa55c1ff9ca0f2315eca5e2}{bytes\_to\_PiB}}(\textcolor{keyword}{const}\ std::size\_t\ numBytes)}
\DoxyCodeLine{00325\ \{}
\DoxyCodeLine{00326\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}NumberType\textcolor{keyword}{>}(numBytes)\ /\ \textcolor{keyword}{static\_cast<}NumberType\textcolor{keyword}{>}(\mbox{\hyperlink{namespaceph_1_1math_1_1constant_a6ada2c0aedc92f05b605e2fd6daf63e7}{constant::PiB}});}
\DoxyCodeLine{00327\ \}}
\DoxyCodeLine{00328\ }
\DoxyCodeLine{00334\ \textcolor{keyword}{inline}\ std::pair<std::size\_t,\ std::size\_t>\ \mbox{\hyperlink{namespaceph_1_1math_a830bc8cab76b0720b0756fce21828b3f}{ith\_evenly\_divided\_range}}(}
\DoxyCodeLine{00335\ \ \ \ \ \textcolor{keyword}{const}\ std::size\_t\ rangeIndex,\ }
\DoxyCodeLine{00336\ \ \ \ \ \textcolor{keyword}{const}\ std::size\_t\ totalSize,}
\DoxyCodeLine{00337\ \ \ \ \ \textcolor{keyword}{const}\ std::size\_t\ numDivisions)}
\DoxyCodeLine{00338\ \{}
\DoxyCodeLine{00339\ \ \ \ \ \textcolor{comment}{//\ TODO:\ it\ is\ possible\ to\ generalize\ to\ signed\ range}}
\DoxyCodeLine{00340\ \ \ \ \ \textcolor{comment}{//\ maybe\ use\ ith\_evenly\_divided\_size()\ as\ function\ name\ and\ }}
\DoxyCodeLine{00341\ \ \ \ \ \textcolor{comment}{//\ ith\_evenly\_divided\_range()\ for\ signed/unsigned\ range}}
\DoxyCodeLine{00342\ }
\DoxyCodeLine{00343\ \ \ \ \ PH\_ASSERT\_GT(numDivisions,\ 0);}
\DoxyCodeLine{00344\ \ \ \ \ PH\_ASSERT\_LT(rangeIndex,\ numDivisions);}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00346\ \ \ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{00347\ \ \ \ \ \{}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ rangeIndex\ *\ totalSize\ /\ numDivisions,}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ (rangeIndex\ +\ 1)\ *\ totalSize\ /\ numDivisions}
\DoxyCodeLine{00350\ \ \ \ \ \};}
\DoxyCodeLine{00351\ \}}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00362\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{namespaceph_1_1math_acc970fbe8bc77521af0103b29e524baa}{fast\_rcp\_sqrt}}(\textcolor{keywordtype}{float}\ x)}
\DoxyCodeLine{00363\ \{}
\DoxyCodeLine{00364\ \ \ \ \ \textcolor{comment}{//\ TODO:\ }}
\DoxyCodeLine{00365\ \ \ \ \ \textcolor{comment}{//\ 1.\ implement\ double\ version\ in\ the\ reference\ paper\ and\ templatize\ iteration\ step}}
\DoxyCodeLine{00366\ \ \ \ \ \textcolor{comment}{//\ 2.\ is\ more\ iteration\ steps\ better\ than\ doing\ it\ in\ double}}
\DoxyCodeLine{00367\ \ \ \ \ \textcolor{comment}{//\ 3.\ establish\ a\ standard,\ e.g.,\ fast\_<X>()\ is\ guaranteed\ to\ have\ max.\ rel.\ error\ <\ 1\%}}
\DoxyCodeLine{00368\ }
\DoxyCodeLine{00369\ \ \ \ \ PH\_ASSERT\_GT(x,\ 0.0f);}
\DoxyCodeLine{00370\ }
\DoxyCodeLine{00371\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ halvedInput\ =\ 0.5f\ *\ x;}
\DoxyCodeLine{00372\ }
\DoxyCodeLine{00373\ \ \ \ \ \textcolor{comment}{//\ Gives\ initial\ guess\ for\ later\ refinements}}
\DoxyCodeLine{00374\ \ \ \ \ \textcolor{keyword}{auto}\ bits\ =\ \mbox{\hyperlink{namespaceph_a74286ca8596f0e37fdc3650c3e72c691}{bitwise\_cast<std::uint32\_t>}}(x);}
\DoxyCodeLine{00375\ \ \ \ \ bits\ =\ 0x5F375A86\ -\/\ (bits\ >>\ 1);}
\DoxyCodeLine{00376\ \ \ \ \ x\ =\ \mbox{\hyperlink{namespaceph_a74286ca8596f0e37fdc3650c3e72c691}{bitwise\_cast<float>}}(bits);}
\DoxyCodeLine{00377\ }
\DoxyCodeLine{00378\ \ \ \ \ \textcolor{comment}{//\ Newton's\ method,\ each\ iteration\ increases\ accuracy.}}
\DoxyCodeLine{00379\ }
\DoxyCodeLine{00380\ \ \ \ \ \textcolor{comment}{//\ Iteration\ 1,\ max.\ relative\ error\ <\ 0.175125\%}}
\DoxyCodeLine{00381\ \ \ \ \ x\ =\ x\ *\ (1.5f\ -\/\ halvedInput\ *\ x\ *\ x);}
\DoxyCodeLine{00382\ }
\DoxyCodeLine{00383\ \ \ \ \ \textcolor{comment}{//\ Iteration\ 2,\ disabled\ since\ <x>\ is\ already\ good\ enough}}
\DoxyCodeLine{00384\ \ \ \ \ \textcolor{comment}{//x\ =\ x\ *\ (1.5f\ -\/\ halvedInput\ *\ x\ *\ x);}}
\DoxyCodeLine{00385\ }
\DoxyCodeLine{00386\ \ \ \ \ \textcolor{keywordflow}{return}\ x;}
\DoxyCodeLine{00387\ \}}
\DoxyCodeLine{00388\ }
\DoxyCodeLine{00391\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{namespaceph_1_1math_adb93254f78909d9fef4bc8d7326b7670}{fast\_sqrt}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ x)}
\DoxyCodeLine{00392\ \{}
\DoxyCodeLine{00393\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespaceph_1_1math_acc970fbe8bc77521af0103b29e524baa}{fast\_rcp\_sqrt}}(x)\ *\ x;}
\DoxyCodeLine{00394\ \}}
\DoxyCodeLine{00395\ }
\DoxyCodeLine{00402\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ \textcolor{keyword}{typename}\ =\ std::enable\_if\_t<std::is\_\textcolor{keywordtype}{int}egral\_v<T>>>}
\DoxyCodeLine{00403\ \textcolor{keyword}{inline}\ T\ \mbox{\hyperlink{namespaceph_1_1math_a2cf56679844b291df412ba311723c828}{reverse\_bits}}(\textcolor{keyword}{const}\ T\ value)}
\DoxyCodeLine{00404\ \{}
\DoxyCodeLine{00405\ \ \ \ \ \textcolor{keyword}{using\ namespace\ }detail;}
\DoxyCodeLine{00406\ }
\DoxyCodeLine{00407\ \ \ \ \ \textcolor{keyword}{static\_assert}(std::is\_integral\_v<T>\ \&\&\ std::is\_unsigned\_v<T>,}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Unsupported\ type\ detected"{}});}
\DoxyCodeLine{00409\ }
\DoxyCodeLine{00410\ \ \ \ \ \textcolor{keyword}{constexpr}\ std::size\_t\ NUM\_BITS\ =\ \textcolor{keyword}{sizeof}(T)\ *\ CHAR\_BIT;}
\DoxyCodeLine{00411\ }
\DoxyCodeLine{00412\ \ \ \ \ \textcolor{comment}{//\ Note\ that\ arbitrary\ number\ of\ bits\ can\ be\ supported\ by\ careful\ handling\ of\ bitwise\ operations}}
\DoxyCodeLine{00413\ \ \ \ \ \textcolor{keyword}{static\_assert}(NUM\_BITS\ \%\ 8\ ==\ 0,}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Non-\/multiple-\/of-\/8\ integer\ bits\ are\ not\ supported"{}});}
\DoxyCodeLine{00415\ }
\DoxyCodeLine{00416\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}(NUM\_BITS\ ==\ 8)}
\DoxyCodeLine{00417\ \ \ \ \ \{}
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ T(\mbox{\hyperlink{namespaceph_1_1math_1_1table_1_1detail_af06511c2d6e975a79a5f5a0f192f7379}{table::detail::BITS8\_REVERSE}}[value]);}
\DoxyCodeLine{00419\ \ \ \ \ \}}
\DoxyCodeLine{00420\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}(NUM\_BITS\ ==\ 16)}
\DoxyCodeLine{00421\ \ \ \ \ \{}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1table_1_1detail_af06511c2d6e975a79a5f5a0f192f7379}{table::detail::BITS8\_REVERSE}}[value\ \ \ \ \ \ \ \ \&\ 0xFF])\ <<\ 8)\ |}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1table_1_1detail_af06511c2d6e975a79a5f5a0f192f7379}{table::detail::BITS8\_REVERSE}}[(value\ >>\ 8)\ \&\ 0xFF]));}
\DoxyCodeLine{00424\ \ \ \ \ \}}
\DoxyCodeLine{00425\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}(NUM\_BITS\ ==\ 32)}
\DoxyCodeLine{00426\ \ \ \ \ \{}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1table_1_1detail_af06511c2d6e975a79a5f5a0f192f7379}{table::detail::BITS8\_REVERSE}}[value\ \ \ \ \ \ \ \ \ \&\ 0xFF])\ <<\ 24)\ |}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1table_1_1detail_af06511c2d6e975a79a5f5a0f192f7379}{table::detail::BITS8\_REVERSE}}[(value\ >>\ 8)\ \ \&\ 0xFF])\ <<\ 16)\ |}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1table_1_1detail_af06511c2d6e975a79a5f5a0f192f7379}{table::detail::BITS8\_REVERSE}}[(value\ >>\ 16)\ \&\ 0xFF])\ <<\ 8)\ \ |}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1table_1_1detail_af06511c2d6e975a79a5f5a0f192f7379}{table::detail::BITS8\_REVERSE}}[(value\ >>\ 24)\ \&\ 0xFF]));}
\DoxyCodeLine{00431\ \ \ \ \ \}}
\DoxyCodeLine{00432\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00433\ \ \ \ \ \{}
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_assert}(NUM\_BITS\ ==\ 64);}
\DoxyCodeLine{00435\ }
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1table_1_1detail_af06511c2d6e975a79a5f5a0f192f7379}{table::detail::BITS8\_REVERSE}}[value\ \ \ \ \ \ \ \ \ \&\ 0xFF])\ <<\ 56)\ |}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1table_1_1detail_af06511c2d6e975a79a5f5a0f192f7379}{table::detail::BITS8\_REVERSE}}[(value\ >>\ 8)\ \ \&\ 0xFF])\ <<\ 48)\ |}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1table_1_1detail_af06511c2d6e975a79a5f5a0f192f7379}{table::detail::BITS8\_REVERSE}}[(value\ >>\ 16)\ \&\ 0xFF])\ <<\ 40)\ |}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1table_1_1detail_af06511c2d6e975a79a5f5a0f192f7379}{table::detail::BITS8\_REVERSE}}[(value\ >>\ 24)\ \&\ 0xFF])\ <<\ 32)\ |}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1table_1_1detail_af06511c2d6e975a79a5f5a0f192f7379}{table::detail::BITS8\_REVERSE}}[(value\ >>\ 32)\ \&\ 0xFF])\ <<\ 24)\ |}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1table_1_1detail_af06511c2d6e975a79a5f5a0f192f7379}{table::detail::BITS8\_REVERSE}}[(value\ >>\ 40)\ \&\ 0xFF])\ <<\ 16)\ |}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1table_1_1detail_af06511c2d6e975a79a5f5a0f192f7379}{table::detail::BITS8\_REVERSE}}[(value\ >>\ 48)\ \&\ 0xFF])\ <<\ 8)\ \ |}
\DoxyCodeLine{00443\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1table_1_1detail_af06511c2d6e975a79a5f5a0f192f7379}{table::detail::BITS8\_REVERSE}}[(value\ >>\ 56)\ \&\ 0xFF]));}
\DoxyCodeLine{00444\ \ \ \ \ \}}
\DoxyCodeLine{00445\ \}}
\DoxyCodeLine{00446\ }
\DoxyCodeLine{00451\ \textcolor{keyword}{template}<std::\textcolor{keywordtype}{unsigned}\_\textcolor{keywordtype}{int}egral\ UIntType,\ std::\textcolor{keywordtype}{int}egral\ RangeType>}
\DoxyCodeLine{00452\ \textcolor{keyword}{inline}\ UIntType\ \mbox{\hyperlink{namespaceph_1_1math_abbf29a619bc4b2cd6e88bbc5e3380a0f}{set\_bits\_in\_range}}(\textcolor{keyword}{const}\ UIntType\ bits,\ \textcolor{keyword}{const}\ RangeType\ beginBitIdx,\ \textcolor{keyword}{const}\ RangeType\ endBitIdx)}
\DoxyCodeLine{00453\ \{}
\DoxyCodeLine{00454\ \ \ \ \ \textcolor{comment}{//\ Inclusive\ as\ empty\ range\ is\ allowed,\ e.g.,\ \`{}beginBitIdx`\ ==\ \`{}endBitIdx`}}
\DoxyCodeLine{00455\ \ \ \ \ PH\_ASSERT\_IN\_RANGE\_INCLUSIVE(beginBitIdx,\ 0,\ endBitIdx);}
\DoxyCodeLine{00456\ \ \ \ \ PH\_ASSERT\_IN\_RANGE\_INCLUSIVE(endBitIdx,\ beginBitIdx,\ \mbox{\hyperlink{namespaceph_af8b01b99e42b7dd15dca28359ac1bf9e}{sizeof\_in\_bits<UIntType>}}());}
\DoxyCodeLine{00457\ }
\DoxyCodeLine{00458\ \ \ \ \ \textcolor{comment}{//\ Mask\ for\ the\ bits\ in\ range.\ Constructed\ by\ producing\ required\ number\ of\ 1's\ then\ shift}}
\DoxyCodeLine{00459\ \ \ \ \ \textcolor{comment}{//\ by\ <beginBitIdx>.\ }}
\DoxyCodeLine{00460\ \ \ \ \ \textcolor{comment}{//\ Note\ that\ if\ there\ is\ integer\ promotion\ to\ signed\ types,\ it\ should\ be\ fine-\/-\/promoted\ type}}
\DoxyCodeLine{00461\ \ \ \ \ \textcolor{comment}{//\ must\ be\ wider\ than\ the\ original\ unsigned\ type,\ the\ bit\ shifts\ will\ never\ reach\ sign\ bit.\ }}
\DoxyCodeLine{00462\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00463\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ bitMask\ =\ \textcolor{keyword}{static\_cast<}UIntType\textcolor{keyword}{>}(((UIntType(1)\ <<\ (endBitIdx\ -\/\ beginBitIdx))\ -\/\ 1)\ <<\ beginBitIdx);}
\DoxyCodeLine{00464\ }
\DoxyCodeLine{00465\ \ \ \ \ \textcolor{keywordflow}{return}\ bits\ |\ bitMask;}
\DoxyCodeLine{00466\ \}}
\DoxyCodeLine{00467\ }
\DoxyCodeLine{00472\ \textcolor{keyword}{template}<std::\textcolor{keywordtype}{unsigned}\_\textcolor{keywordtype}{int}egral\ UIntType,\ std::\textcolor{keywordtype}{int}egral\ RangeType>}
\DoxyCodeLine{00473\ \textcolor{keyword}{inline}\ UIntType\ \mbox{\hyperlink{namespaceph_1_1math_af11f191a13f32e5ff37ba539bb731029}{clear\_bits\_in\_range}}(\textcolor{keyword}{const}\ UIntType\ bits,\ \textcolor{keyword}{const}\ RangeType\ beginBitIdx,\ \textcolor{keyword}{const}\ RangeType\ endBitIdx)}
\DoxyCodeLine{00474\ \{}
\DoxyCodeLine{00475\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ bitMask\ =\ \mbox{\hyperlink{namespaceph_1_1math_abbf29a619bc4b2cd6e88bbc5e3380a0f}{set\_bits\_in\_range<UIntType,\ RangeType>}}(UIntType(0),\ beginBitIdx,\ endBitIdx);}
\DoxyCodeLine{00476\ \ \ \ \ \textcolor{keywordflow}{return}\ bits\ \&\ (\string~bitMask);}
\DoxyCodeLine{00477\ \}}
\DoxyCodeLine{00478\ }
\DoxyCodeLine{00483\ \textcolor{keyword}{template}<std::\textcolor{keywordtype}{unsigned}\_\textcolor{keywordtype}{int}egral\ UIntType>}
\DoxyCodeLine{00484\ \textcolor{keyword}{inline}\ UIntType\ \mbox{\hyperlink{namespaceph_1_1math_a00c7265b62195ee8215d3a07ee97d8a6}{flag\_bit}}(\textcolor{keyword}{const}\ UIntType\ bitIdx)}
\DoxyCodeLine{00485\ \{}
\DoxyCodeLine{00486\ \ \ \ \ PH\_ASSERT\_IN\_RANGE(bitIdx,\ 0,\ \mbox{\hyperlink{namespaceph_af8b01b99e42b7dd15dca28359ac1bf9e}{sizeof\_in\_bits<UIntType>}}());}
\DoxyCodeLine{00487\ }
\DoxyCodeLine{00488\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}UIntType\textcolor{keyword}{>}(1)\ <<\ bitIdx;}
\DoxyCodeLine{00489\ \}}
\DoxyCodeLine{00490\ }
\DoxyCodeLine{00491\ \textcolor{keyword}{template}<std::\textcolor{keywordtype}{unsigned}\_\textcolor{keywordtype}{int}egral\ UIntType,\ UIntType\ BIT\_IDX>}
\DoxyCodeLine{00492\ \textcolor{keyword}{inline}\ \textcolor{keyword}{consteval}\ UIntType\ \mbox{\hyperlink{namespaceph_1_1math_a00c7265b62195ee8215d3a07ee97d8a6}{flag\_bit}}()}
\DoxyCodeLine{00493\ \{}
\DoxyCodeLine{00494\ \ \ \ \ \textcolor{keyword}{static\_assert}(0\ <=\ BIT\_IDX\ \&\&\ BIT\_IDX\ <\ sizeof\_in\_bits<UIntType>(),}
\DoxyCodeLine{00495\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}BIT\_IDX\ must\ be\ within\ [0,\ \#\ bits\ in\ UIntType)"{}});}
\DoxyCodeLine{00496\ }
\DoxyCodeLine{00497\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}UIntType\textcolor{keyword}{>}(1)\ <<\ BIT\_IDX;}
\DoxyCodeLine{00498\ \}}
\DoxyCodeLine{00500\ }
\DoxyCodeLine{00501\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ T\ MIN,\ T\ MAX,\ std::\textcolor{keywordtype}{size\_t}\ N>}
\DoxyCodeLine{00502\ \textcolor{keyword}{inline}\ std::array<T,\ N>\ \mbox{\hyperlink{namespaceph_1_1math_a5ffba8a0fe5af3a10b2b568ff3f26124}{evenly\_spaced\_array}}()}
\DoxyCodeLine{00503\ \{}
\DoxyCodeLine{00504\ \ \ \ \ \textcolor{keyword}{static\_assert}(\mbox{\hyperlink{namespaceph_1_1math_ae7853802be4d35a3625b5f313151d1baa26a4b44a837bf97b972628509912b4a5}{MAX}}\ >\ \mbox{\hyperlink{namespaceph_1_1math_ae7853802be4d35a3625b5f313151d1baace31e2a082d17e038fcc6e3006166653}{MIN}});}
\DoxyCodeLine{00505\ \ \ \ \ \textcolor{keyword}{static\_assert}(N\ >=\ 2);}
\DoxyCodeLine{00506\ }
\DoxyCodeLine{00507\ \ \ \ \ \textcolor{keyword}{constexpr}\ T\ TOTAL\_SIZE\ =\ \mbox{\hyperlink{namespaceph_1_1math_ae7853802be4d35a3625b5f313151d1baa26a4b44a837bf97b972628509912b4a5}{MAX}}\ -\/\ \mbox{\hyperlink{namespaceph_1_1math_ae7853802be4d35a3625b5f313151d1baace31e2a082d17e038fcc6e3006166653}{MIN}};}
\DoxyCodeLine{00508\ }
\DoxyCodeLine{00509\ \ \ \ \ std::array<T,\ N>\ arr;}
\DoxyCodeLine{00510\ \ \ \ \ arr[0]\ =\ \mbox{\hyperlink{namespaceph_1_1math_ae7853802be4d35a3625b5f313151d1baace31e2a082d17e038fcc6e3006166653}{MIN}};}
\DoxyCodeLine{00511\ \ \ \ \ \textcolor{keywordflow}{for}(std::size\_t\ i\ =\ 1;\ i\ <\ N\ -\/\ 1;\ ++i)}
\DoxyCodeLine{00512\ \ \ \ \ \{}
\DoxyCodeLine{00513\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ current\ fraction\ i/(N-\/1),\ and\ multiply\ it\ with\ the\ total\ size}}
\DoxyCodeLine{00514\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ (we\ multiply\ total\ size\ with\ i\ fist,\ otherwise\ integral\ types\ will\ always\ result\ in\ 0)}}
\DoxyCodeLine{00515\ \ \ \ \ \ \ \ \ arr[i]\ =\ \mbox{\hyperlink{namespaceph_1_1math_ae7853802be4d35a3625b5f313151d1baace31e2a082d17e038fcc6e3006166653}{MIN}}\ +\ \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(i\ *\ TOTAL\_SIZE\ /\ (N\ -\/\ 1));}
\DoxyCodeLine{00516\ }
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ PH\_ASSERT\_IN\_RANGE\_INCLUSIVE(arr[i],\ \mbox{\hyperlink{namespaceph_1_1math_ae7853802be4d35a3625b5f313151d1baace31e2a082d17e038fcc6e3006166653}{MIN}},\ \mbox{\hyperlink{namespaceph_1_1math_ae7853802be4d35a3625b5f313151d1baa26a4b44a837bf97b972628509912b4a5}{MAX}});}
\DoxyCodeLine{00518\ \ \ \ \ \}}
\DoxyCodeLine{00519\ \ \ \ \ arr[N\ -\/\ 1]\ =\ \mbox{\hyperlink{namespaceph_1_1math_ae7853802be4d35a3625b5f313151d1baa26a4b44a837bf97b972628509912b4a5}{MAX}};}
\DoxyCodeLine{00520\ }
\DoxyCodeLine{00521\ \ \ \ \ \textcolor{keywordflow}{return}\ arr;}
\DoxyCodeLine{00522\ \}}
\DoxyCodeLine{00523\ }
\DoxyCodeLine{00524\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00525\ \textcolor{keyword}{inline}\ std::vector<T>\ \mbox{\hyperlink{namespaceph_1_1math_a95653bcb43b37e51af4fe120f25e9099}{evenly\_spaced\_vector}}(\textcolor{keyword}{const}\ T\ min,\ \textcolor{keyword}{const}\ T\ max,\ \textcolor{keyword}{const}\ std::size\_t\ n)}
\DoxyCodeLine{00526\ \{}
\DoxyCodeLine{00527\ \ \ \ \ PH\_ASSERT\_GT(max,\ min);}
\DoxyCodeLine{00528\ \ \ \ \ PH\_ASSERT\_GE(n,\ 2);}
\DoxyCodeLine{00529\ }
\DoxyCodeLine{00530\ \ \ \ \ \textcolor{keyword}{const}\ T\ totalSize\ =\ max\ -\/\ min;}
\DoxyCodeLine{00531\ }
\DoxyCodeLine{00532\ \ \ \ \ std::vector<T>\ vec(n,\ 0);}
\DoxyCodeLine{00533\ \ \ \ \ vec[0]\ =\ min;}
\DoxyCodeLine{00534\ \ \ \ \ \textcolor{keywordflow}{for}(std::size\_t\ i\ =\ 0;\ i\ <\ n;\ ++i)}
\DoxyCodeLine{00535\ \ \ \ \ \{}
\DoxyCodeLine{00536\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ current\ fraction\ i/(n-\/1),\ and\ multiply\ it\ with\ the\ total\ size}}
\DoxyCodeLine{00537\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ (we\ multiply\ total\ size\ with\ i\ fist,\ otherwise\ integral\ types\ will\ always\ result\ in\ 0)}}
\DoxyCodeLine{00538\ \ \ \ \ \ \ \ \ vec[i]\ =\ min\ +\ \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(i\ *\ totalSize\ /\ (n\ -\/\ 1));}
\DoxyCodeLine{00539\ }
\DoxyCodeLine{00540\ \ \ \ \ \ \ \ \ PH\_ASSERT\_IN\_RANGE\_INCLUSIVE(vec[i],\ min,\ max);}
\DoxyCodeLine{00541\ \ \ \ \ \}}
\DoxyCodeLine{00542\ \ \ \ \ vec[n\ -\/\ 1]\ =\ max;}
\DoxyCodeLine{00543\ \ \ \ \ \textcolor{keywordflow}{return}\ vec;}
\DoxyCodeLine{00544\ \}}
\DoxyCodeLine{00545\ }
\DoxyCodeLine{00552\ \textcolor{comment}{//\ TODO:\ handle\ denormalized\ value\ and\ others\ (std::frexp\ seems\ interesting)}}
\DoxyCodeLine{00553\ \textcolor{comment}{//\ https://stackoverflow.com/questions/6162651/half-\/precision-\/floating-\/point-\/in-\/java}}
\DoxyCodeLine{00555\ }
\DoxyCodeLine{00557\ \textcolor{keyword}{inline}\ uint16\ \mbox{\hyperlink{namespaceph_1_1math_a91780ac8e52ddfdd3f0314cc36b882c2}{fp32\_to\_fp16\_bits}}(\textcolor{keyword}{const}\ float32\ value)}
\DoxyCodeLine{00558\ \{}
\DoxyCodeLine{00559\ \ \ \ \ \textcolor{keyword}{static\_assert}(std::numeric\_limits<float32>::is\_iec559);}
\DoxyCodeLine{00560\ }
\DoxyCodeLine{00561\ \ \ \ \ \textcolor{keywordflow}{if}(std::abs(value)\ <\ 0.0000610352f)}
\DoxyCodeLine{00562\ \ \ \ \ \{}
\DoxyCodeLine{00563\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::signbit(value)\ ?\ 0x8000\ :\ 0x0000;}
\DoxyCodeLine{00564\ \ \ \ \ \}}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00566\ \ \ \ \ uint16\ fp16Bits;}
\DoxyCodeLine{00567\ \ \ \ \ uint32\ fp32Bits;}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00569\ \ \ \ \ fp32Bits\ =\ std::bit\_cast<uint32>(value);}
\DoxyCodeLine{00570\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00571\ \ \ \ \ \textcolor{comment}{//\ truncate\ the\ mantissa\ and\ doing\ (exp\ -\/\ 127\ +\ 15)}}
\DoxyCodeLine{00572\ \ \ \ \ fp16Bits\ =\ \ \textcolor{keyword}{static\_cast<}uint16\textcolor{keyword}{>}((((fp32Bits\ \&\ 0x7FFFFFFF)\ >>\ 13)\ -\/\ (0x38000000\ >>\ 13)));}
\DoxyCodeLine{00573\ \ \ \ \ fp16Bits\ |=\ ((fp32Bits\ \&\ 0x80000000)\ >>\ 16);\textcolor{comment}{//\ sign}}
\DoxyCodeLine{00574\ }
\DoxyCodeLine{00575\ \ \ \ \ \textcolor{keywordflow}{return}\ fp16Bits;}
\DoxyCodeLine{00576\ \}}
\DoxyCodeLine{00577\ }
\DoxyCodeLine{00580\ \textcolor{keyword}{inline}\ float32\ \mbox{\hyperlink{namespaceph_1_1math_a050fd048afd360173b15c10a05c21f7c}{fp16\_bits\_to\_fp32}}(\textcolor{keyword}{const}\ uint16\ fp16Bits)}
\DoxyCodeLine{00581\ \{}
\DoxyCodeLine{00582\ \ \ \ \ \textcolor{keyword}{static\_assert}(std::numeric\_limits<float32>::is\_iec559);}
\DoxyCodeLine{00583\ }
\DoxyCodeLine{00584\ \ \ \ \ \textcolor{comment}{//\ 0\ if\ all\ bits\ other\ than\ the\ sign\ bit\ are\ 0}}
\DoxyCodeLine{00585\ \ \ \ \ \textcolor{keywordflow}{if}((fp16Bits\ \&\ 0x7FFF)\ ==\ 0)}
\DoxyCodeLine{00586\ \ \ \ \ \{}
\DoxyCodeLine{00587\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (fp16Bits\ \&\ 0x8000)\ ==\ 0\ ?\ 0.0f\ :\ -\/0.0f;}
\DoxyCodeLine{00588\ \ \ \ \ \}}
\DoxyCodeLine{00589\ }
\DoxyCodeLine{00590\ \ \ \ \ uint32\ fp32Bits\ =\ ((fp16Bits\ \&\ 0x8000)\ <<\ 16);}
\DoxyCodeLine{00591\ \ \ \ \ fp32Bits\ |=\ (((fp16Bits\ \&\ 0x7FFF)\ <<\ 13)\ +\ 0x38000000);}
\DoxyCodeLine{00592\ }
\DoxyCodeLine{00593\ \ \ \ \ \textcolor{keywordflow}{return}\ std::bit\_cast<float32>(fp32Bits);}
\DoxyCodeLine{00594\ \}}
\DoxyCodeLine{00596\ }
\DoxyCodeLine{00602\ \textcolor{comment}{//\ TODO:\ numeric\ analysis}}
\DoxyCodeLine{00603\ \textcolor{comment}{//\ TODO:\ long\ double\ is\ not\ needed\ for\ shorter\ integer\ types}}
\DoxyCodeLine{00604\ \textcolor{keyword}{template}<std::\textcolor{keywordtype}{float}ing\_po\textcolor{keywordtype}{int}\ FloatType,\ std::\textcolor{keywordtype}{int}egral\ IntType>}
\DoxyCodeLine{00605\ \textcolor{keyword}{inline}\ FloatType\ \mbox{\hyperlink{namespaceph_1_1math_a4690860b243fe5e072ff6048732ae2a3}{normalize\_integer}}(\textcolor{keyword}{const}\ IntType\ intVal)}
\DoxyCodeLine{00606\ \{}
\DoxyCodeLine{00607\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}(std::is\_unsigned\_v<IntType>)}
\DoxyCodeLine{00608\ \ \ \ \ \{}
\DoxyCodeLine{00609\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}FloatType\textcolor{keyword}{>}(}
\DoxyCodeLine{00610\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}\textcolor{keyword}{>}(intVal)\ /\ std::numeric\_limits<IntType>::max());}
\DoxyCodeLine{00611\ \ \ \ \ \}}
\DoxyCodeLine{00612\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00613\ \ \ \ \ \{}
\DoxyCodeLine{00614\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}FloatType\textcolor{keyword}{>}(intVal\ >=\ 0}
\DoxyCodeLine{00615\ \ \ \ \ \ \ \ \ \ \ \ \ ?\ \ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}\textcolor{keyword}{>}(intVal)\ /\ std::numeric\_limits<IntType>::max()}
\DoxyCodeLine{00616\ \ \ \ \ \ \ \ \ \ \ \ \ :\ -\/\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}\textcolor{keyword}{>}(intVal)\ /\ std::numeric\_limits<IntType>::min());}
\DoxyCodeLine{00617\ \ \ \ \ \}}
\DoxyCodeLine{00618\ \}}
\DoxyCodeLine{00619\ }
\DoxyCodeLine{00620\ \textcolor{comment}{//\ TODO:\ numeric\ analysis}}
\DoxyCodeLine{00621\ \textcolor{comment}{//\ TODO:\ long\ double\ is\ not\ needed\ for\ shorter\ integer\ types}}
\DoxyCodeLine{00622\ \textcolor{keyword}{template}<std::\textcolor{keywordtype}{int}egral\ IntType,\ std::\textcolor{keywordtype}{float}ing\_po\textcolor{keywordtype}{int}\ FloatType>}
\DoxyCodeLine{00623\ \textcolor{keyword}{inline}\ IntType\ \mbox{\hyperlink{namespaceph_1_1math_a403680d6446383625398ed0c057c43fd}{quantize\_normalized\_float}}(\textcolor{keyword}{const}\ FloatType\ floatVal)}
\DoxyCodeLine{00624\ \{}
\DoxyCodeLine{00625\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}(std::is\_unsigned\_v<IntType>)}
\DoxyCodeLine{00626\ \ \ \ \ \{}
\DoxyCodeLine{00627\ \ \ \ \ \ \ \ \ PH\_ASSERT\_IN\_RANGE\_INCLUSIVE(floatVal,\ 0.0f,\ 1.0f);}
\DoxyCodeLine{00628\ }
\DoxyCodeLine{00629\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}IntType\textcolor{keyword}{>}(}
\DoxyCodeLine{00630\ \ \ \ \ \ \ \ \ \ \ \ \ std::round(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}\textcolor{keyword}{>}(floatVal)\ *\ std::numeric\_limits<IntType>::max()));}
\DoxyCodeLine{00631\ \ \ \ \ \}}
\DoxyCodeLine{00632\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00633\ \ \ \ \ \{}
\DoxyCodeLine{00634\ \ \ \ \ \ \ \ \ PH\_ASSERT\_IN\_RANGE\_INCLUSIVE(floatVal,\ -\/1.0f,\ 1.0f);}
\DoxyCodeLine{00635\ }
\DoxyCodeLine{00636\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}IntType\textcolor{keyword}{>}(floatVal\ >=\ 0}
\DoxyCodeLine{00637\ \ \ \ \ \ \ \ \ \ \ \ \ ?\ std::round(\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}\textcolor{keyword}{>}(floatVal)\ *\ std::numeric\_limits<IntType>::max())}
\DoxyCodeLine{00638\ \ \ \ \ \ \ \ \ \ \ \ \ :\ std::round(-\/\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}\textcolor{keyword}{>}(floatVal)\ *\ std::numeric\_limits<IntType>::min()));}
\DoxyCodeLine{00639\ \ \ \ \ \}}
\DoxyCodeLine{00640\ \}}
\DoxyCodeLine{00641\ }
\DoxyCodeLine{00646\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespaceph_1_1math_a996b8aaa152f5e58eea616b7340f7659}{uint64\_mul}}(\textcolor{keyword}{const}\ uint64\ lhs,\ \textcolor{keyword}{const}\ uint64\ rhs,\ uint64\&\ out\_high64,\ uint64\&\ out\_low64)}
\DoxyCodeLine{00647\ \{}
\DoxyCodeLine{00648\ \textcolor{preprocessor}{\#if\ defined(\_\_SIZEOF\_INT128\_\_)}}
\DoxyCodeLine{00649\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ result128\ =\ \_\_uint128\_t(lhs)\ +\ \_\_uint128\_t(rhs);}
\DoxyCodeLine{00650\ \ \ \ \ out\_high64\ =\ \textcolor{keyword}{static\_cast<}uint64\textcolor{keyword}{>}(result128\ >>\ 64);}
\DoxyCodeLine{00651\ \ \ \ \ out\_low64\ =\ \textcolor{keyword}{static\_cast<}uint64\textcolor{keyword}{>}(result128);}
\DoxyCodeLine{00652\ \textcolor{preprocessor}{\#elif\ PH\_COMPILER\_IS\_MSVC}}
\DoxyCodeLine{00653\ \ \ \ \ out\_low64\ =\ \_umul128(lhs,\ rhs,\ \&out\_high64);}
\DoxyCodeLine{00654\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00655\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00656\ \textcolor{comment}{\ \ \ \ Divide\ each\ 64-\/bit\ number\ into\ two\ 32-\/bit\ parts,\ then\ multiplying\ (or\ adding)\ any\ 32-\/bit}}
\DoxyCodeLine{00657\ \textcolor{comment}{\ \ \ \ pairs\ cannot\ overflow\ if\ done\ using\ 64-\/bit\ arithmetic.\ If\ we\ multiply\ them\ using\ base\ 2\string^32\ }}
\DoxyCodeLine{00658\ \textcolor{comment}{\ \ \ \ arithmetic,\ a\ total\ of\ 4\ products\ must\ be\ shifted\ and\ added\ to\ obtain\ the\ final\ result.\ }}
\DoxyCodeLine{00659\ \textcolor{comment}{\ \ \ \ Here\ is\ a\ simple\ illustration\ of\ the\ algorithm:}}
\DoxyCodeLine{00660\ \textcolor{comment}{}}
\DoxyCodeLine{00661\ \textcolor{comment}{\ \ \ \ lhs\ =\ [\ a\ ][\ b\ ]}}
\DoxyCodeLine{00662\ \textcolor{comment}{\ \ \ \ rhs\ =\ [\ c\ ][\ d\ ]}}
\DoxyCodeLine{00663\ \textcolor{comment}{}}
\DoxyCodeLine{00664\ \textcolor{comment}{\ \ \ \ Treat\ this\ like\ performing\ a\ regular\ multiplication\ on\ paper.\ Note\ that\ the\ multiplication}}
\DoxyCodeLine{00665\ \textcolor{comment}{\ \ \ \ is\ done\ in\ base\ 2\string^32:}}
\DoxyCodeLine{00666\ \textcolor{comment}{}}
\DoxyCodeLine{00667\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [\ a\ ][\ b\ ]}}
\DoxyCodeLine{00668\ \textcolor{comment}{\ \ \ \ \ \ x\ \ \ \ \ \ \ \ [\ c\ ][\ d\ ]}}
\DoxyCodeLine{00669\ \textcolor{comment}{\ \ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00670\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [a*d][b*d]}}
\DoxyCodeLine{00671\ \textcolor{comment}{\ \ \ \ \ \ +\ \ \ [a*c][b*c]}}
\DoxyCodeLine{00672\ \textcolor{comment}{\ \ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00673\ \textcolor{comment}{}}
\DoxyCodeLine{00674\ \textcolor{comment}{\ \ \ \ \ \ The\ overflowing\ part\ of\ each\ partial\ product\ is\ the\ carry\ (32-\/bit\ carry).\ This\ is\ a\ good\ reference:}}
\DoxyCodeLine{00675\ \textcolor{comment}{\ \ \ \ \ \ https://stackoverflow.com/questions/26852435/reasonably-\/portable-\/way-\/to-\/get-\/top-\/64-\/bits-\/from-\/64x64-\/bit-\/multiply}}
\DoxyCodeLine{00676\ \textcolor{comment}{\ \ \ \ */}}
\DoxyCodeLine{00677\ }
\DoxyCodeLine{00678\ \ \ \ \ \textcolor{keyword}{const}\ uint64\ a\ =\ lhs\ >>\ 32,\ b\ =\ lhs\ \&\ 0xFFFFFFFF;}
\DoxyCodeLine{00679\ \ \ \ \ \textcolor{keyword}{const}\ uint64\ c\ =\ rhs\ >>\ 32,\ d\ =\ rhs\ \&\ 0xFFFFFFFF;}
\DoxyCodeLine{00680\ }
\DoxyCodeLine{00681\ \ \ \ \ \textcolor{keyword}{const}\ uint64\ ac\ =\ a\ *\ c;}
\DoxyCodeLine{00682\ \ \ \ \ \textcolor{keyword}{const}\ uint64\ bc\ =\ b\ *\ c;}
\DoxyCodeLine{00683\ \ \ \ \ \textcolor{keyword}{const}\ uint64\ ad\ =\ a\ *\ d;}
\DoxyCodeLine{00684\ \ \ \ \ \textcolor{keyword}{const}\ uint64\ bd\ =\ b\ *\ d;}
\DoxyCodeLine{00685\ }
\DoxyCodeLine{00686\ \ \ \ \ \textcolor{comment}{//\ This\ is\ the\ middle\ part\ of\ the\ above\ illustration,\ which\ is\ a\ sum\ of\ three\ 32-\/bit\ numbers\ }}
\DoxyCodeLine{00687\ \ \ \ \ \textcolor{comment}{//\ (so\ it\ is\ 34-\/bit\ at\ most):\ two\ products\ b*c\ and\ a*d,\ and\ the\ carry\ from\ b*d}}
\DoxyCodeLine{00688\ \ \ \ \ \textcolor{keyword}{const}\ uint64\ mid34\ =\ (bd\ >>\ 32)\ +\ (bc\ \&\ 0xFFFFFFFF)\ +\ (ad\ \&\ 0xFFFFFFFF);}
\DoxyCodeLine{00689\ }
\DoxyCodeLine{00690\ \ \ \ \ out\_high64\ =\ ac\ +\ (bc\ >>\ 32)\ +\ (ad\ >>\ 32)\ +\ (mid34\ >>\ 32);}
\DoxyCodeLine{00691\ \ \ \ \ out\_low64\ =\ (mid34\ <<\ 32)\ |\ (bd\ \&\ 0xFFFFFFFF);}
\DoxyCodeLine{00692\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00693\ \}}
\DoxyCodeLine{00694\ }
\DoxyCodeLine{00698\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ std::\textcolor{keywordtype}{size\_t}\ N>}
\DoxyCodeLine{00699\ T\ \mbox{\hyperlink{namespaceph_1_1math_a5e1143174acd6afb8b6c9be755307c4b}{length}}(\textcolor{keyword}{const}\ std::array<T,\ N>\&\ vec);}
\DoxyCodeLine{00700\ }
\DoxyCodeLine{00701\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00702\ T\ \mbox{\hyperlink{namespaceph_1_1math_a5e1143174acd6afb8b6c9be755307c4b}{length}}(\textcolor{keyword}{const}\ std::vector<T>\&\ vec);}
\DoxyCodeLine{00703\ }
\DoxyCodeLine{00704\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ std::\textcolor{keywordtype}{size\_t}\ EXTENT\ =\ std::dynamic\_extent>}
\DoxyCodeLine{00705\ T\ \mbox{\hyperlink{namespaceph_1_1math_a5e1143174acd6afb8b6c9be755307c4b}{length}}(\mbox{\hyperlink{namespaceph_a06c532bb78132f63638ec3ef52d46ff3}{TSpanView<T,\ EXTENT>}}\ vec);}
\DoxyCodeLine{00707\ }
\DoxyCodeLine{00711\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ std::\textcolor{keywordtype}{size\_t}\ N>}
\DoxyCodeLine{00712\ T\ \mbox{\hyperlink{namespaceph_1_1math_a271473c0e491fe4c7c0cb02fcfa88bb0}{length\_squared}}(\textcolor{keyword}{const}\ std::array<T,\ N>\&\ vec);}
\DoxyCodeLine{00713\ }
\DoxyCodeLine{00714\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00715\ T\ \mbox{\hyperlink{namespaceph_1_1math_a271473c0e491fe4c7c0cb02fcfa88bb0}{length\_squared}}(\textcolor{keyword}{const}\ std::vector<T>\&\ vec);}
\DoxyCodeLine{00716\ }
\DoxyCodeLine{00717\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ std::\textcolor{keywordtype}{size\_t}\ EXTENT\ =\ std::dynamic\_extent>}
\DoxyCodeLine{00718\ T\ \mbox{\hyperlink{namespaceph_1_1math_a271473c0e491fe4c7c0cb02fcfa88bb0}{length\_squared}}(\mbox{\hyperlink{namespaceph_a06c532bb78132f63638ec3ef52d46ff3}{TSpanView<T,\ EXTENT>}}\ vec);}
\DoxyCodeLine{00720\ }
\DoxyCodeLine{00724\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ std::\textcolor{keywordtype}{size\_t}\ N>}
\DoxyCodeLine{00725\ T\ \mbox{\hyperlink{namespaceph_1_1math_a4ff51da9284135e078f892589a4816cc}{p\_norm}}(\textcolor{keyword}{const}\ std::array<T,\ N>\&\ vec);}
\DoxyCodeLine{00726\ }
\DoxyCodeLine{00727\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00728\ T\ \mbox{\hyperlink{namespaceph_1_1math_a4ff51da9284135e078f892589a4816cc}{p\_norm}}(\textcolor{keyword}{const}\ std::vector<T>\&\ vec);}
\DoxyCodeLine{00729\ }
\DoxyCodeLine{00730\ \textcolor{keyword}{template}<std::\textcolor{keywordtype}{size\_t}\ P,\ \textcolor{keyword}{typename}\ T,\ std::\textcolor{keywordtype}{size\_t}\ EXTENT\ =\ std::dynamic\_extent>}
\DoxyCodeLine{00731\ T\ \mbox{\hyperlink{namespaceph_1_1math_a4ff51da9284135e078f892589a4816cc}{p\_norm}}(\mbox{\hyperlink{namespaceph_a06c532bb78132f63638ec3ef52d46ff3}{TSpanView<T,\ EXTENT>}}\ vec);}
\DoxyCodeLine{00733\ }
\DoxyCodeLine{00739\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ std::\textcolor{keywordtype}{size\_t}\ N>}
\DoxyCodeLine{00740\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespaceph_1_1math_a4f0591b11fba7210f6dd38cfbbcbc9f7}{normalize}}(std::array<T,\ N>\&\ vec);}
\DoxyCodeLine{00741\ }
\DoxyCodeLine{00742\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00743\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespaceph_1_1math_a4f0591b11fba7210f6dd38cfbbcbc9f7}{normalize}}(std::vector<T>\&\ vec);}
\DoxyCodeLine{00744\ }
\DoxyCodeLine{00745\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ std::\textcolor{keywordtype}{size\_t}\ EXTENT\ =\ std::dynamic\_extent>}
\DoxyCodeLine{00746\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespaceph_1_1math_a4f0591b11fba7210f6dd38cfbbcbc9f7}{normalize}}(\mbox{\hyperlink{namespaceph_a5390437e1d7fd7d167c847677ea146e6}{TSpan<T,\ EXTENT>}}\ vec);}
\DoxyCodeLine{00748\ }
\DoxyCodeLine{00752\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ std::\textcolor{keywordtype}{size\_t}\ N>}
\DoxyCodeLine{00753\ T\ \mbox{\hyperlink{namespaceph_1_1math_a03f8a077523cb1f8d667a39529300e98}{dot\_product}}(\textcolor{keyword}{const}\ std::array<T,\ N>\&\ vecA,\ \textcolor{keyword}{const}\ std::array<T,\ N>\&\ vecB);}
\DoxyCodeLine{00754\ }
\DoxyCodeLine{00755\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00756\ T\ \mbox{\hyperlink{namespaceph_1_1math_a03f8a077523cb1f8d667a39529300e98}{dot\_product}}(\textcolor{keyword}{const}\ std::vector<T>\&\ vecA,\ \textcolor{keyword}{const}\ std::vector<T>\&\ vecB);}
\DoxyCodeLine{00757\ }
\DoxyCodeLine{00758\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ std::\textcolor{keywordtype}{size\_t}\ EXTENT\ =\ std::dynamic\_extent>}
\DoxyCodeLine{00759\ T\ \mbox{\hyperlink{namespaceph_1_1math_a03f8a077523cb1f8d667a39529300e98}{dot\_product}}(\mbox{\hyperlink{namespaceph_a06c532bb78132f63638ec3ef52d46ff3}{TSpanView<T,\ EXTENT>}}\ vecA,\ \mbox{\hyperlink{namespaceph_a06c532bb78132f63638ec3ef52d46ff3}{TSpanView<T,\ EXTENT>}}\ vecB);}
\DoxyCodeLine{00761\ }
\DoxyCodeLine{00762\ \}\textcolor{comment}{//\ end\ namespace\ ph::math}}
\DoxyCodeLine{00763\ }
\DoxyCodeLine{00764\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{math_8ipp}{Math/math.ipp}}"{}}}

\end{DoxyCode}
