\doxysection{math.\+h}
\hypertarget{math_8h_source}{}\label{math_8h_source}\index{Source/Math/math.h@{Source/Math/math.h}}
\mbox{\hyperlink{math_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{constant_8h}{Math/constant.h}}"{}}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{math__fwd_8h}{Math/math\_fwd.h}}"{}}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{math__table_8h}{Math/math\_table.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{utility_8h}{Utility/utility.h}}"{}}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ <Common/assertion.h>}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ <Common/primitive\_type.h>}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ <Common/compiler.h>}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <Common/math\_basics.h>}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ <cmath>}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <algorithm>}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ <type\_traits>}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ <utility>}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ <limits>}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ <array>}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ <cstdint>}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ <climits>}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ <bit>}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ <concepts>}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#if\ PH\_COMPILER\_IS\_MSVC}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ <intrin.h>}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#pragma\ intrinsic(\_BitScanReverse)}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#pragma\ intrinsic(\_umul128)}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceph_1_1math}{ph::math}}}
\DoxyCodeLine{00041\ \{}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00044\ \textcolor{keyword}{inline}\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{namespaceph_1_1math_af09fabd051200745fc83ab8e6119be17}{matrix2x2}}(\textcolor{keyword}{const}\ T\ e00,\ \textcolor{keyword}{const}\ T\ e01,\ \textcolor{keyword}{const}\ T\ e10,\ \textcolor{keyword}{const}\ T\ e11)}
\DoxyCodeLine{00045\ \ \ \ \ -\/>\ std::array<std::array<T,\ 2>,\ 2>}
\DoxyCodeLine{00046\ \{}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{00048\ \ \ \ \ \{\{}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \{\{e00,\ e01\}\},}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \{\{e10,\ e11\}\}}
\DoxyCodeLine{00051\ \ \ \ \ \}\};}
\DoxyCodeLine{00052\ \}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00055\ \textcolor{keyword}{inline}\ T\ \mbox{\hyperlink{namespaceph_1_1math_a3d95f12613138cf607ca4b4b0c04ea48}{squared}}(\textcolor{keyword}{const}\ T\ value)}
\DoxyCodeLine{00056\ \{}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keywordflow}{return}\ value\ *\ value;}
\DoxyCodeLine{00058\ \}}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \textcolor{comment}{//\ A\ fast,\ without\ sqrt(),\ nearly\ branchless\ method.\ Notice\ that\ Photon\ uses\ y-\/axis\ as\ the\ up/normal\ vector.\ }}
\DoxyCodeLine{00061\ \textcolor{comment}{//\ This\ static\ method\ implements\ the\ y-\/is-\/normal\ version\ which\ is\ different\ from\ the\ original\ paper.}}
\DoxyCodeLine{00062\ \textcolor{comment}{//\ (Reference:\ Frisvad,\ Jeppe\ Revall,\ "{}Building\ an\ Orthonormal\ Basis\ from\ a\ 3D\ Unit\ Vector\ Without\ Normalization"{},\ }}
\DoxyCodeLine{00063\ \textcolor{comment}{//\ Journal\ of\ Graphics\ Tools,\ 2012)}}
\DoxyCodeLine{00064\ \textcolor{comment}{//\ Note:\ This\ method\ seems\ to\ have\ larger\ numerical\ error\ (at\ least\ 10\string^3\ larger\ than\ my\ naive\ method),\ }}
\DoxyCodeLine{00065\ \textcolor{comment}{//\ thus\ it\ is\ not\ used\ currently.}}
\DoxyCodeLine{00066\ \textcolor{comment}{//}}
\DoxyCodeLine{00067\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespaceph_1_1math_a14234263f1191fde0644069273c63a87}{form\_orthonormal\_basis\_frisvad}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classph_1_1math_1_1_t_vector3}{Vector3R}}\&\ unitYaxis,\ \mbox{\hyperlink{classph_1_1math_1_1_t_vector3}{Vector3R}}*\ \textcolor{keyword}{const}\ out\_unitXaxis,\ \mbox{\hyperlink{classph_1_1math_1_1_t_vector3}{Vector3R}}*\ \textcolor{keyword}{const}\ out\_unitZaxis);}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \textcolor{comment}{//\ Clamp\ a\ value\ to\ specific\ range.\ If\ a\ floating-\/point\ value\ is\ NaN,\ its\ }}
\DoxyCodeLine{00070\ \textcolor{comment}{//\ value\ is\ clamped\ to\ lower\ bound.\ Neither\ lower\ bound\ or\ upper\ bound\ }}
\DoxyCodeLine{00071\ \textcolor{comment}{//\ can\ be\ NaN,\ or\ the\ method's\ behavior\ is\ undefined.}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00075\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ std::enable\_if\_t<!std::is\_\textcolor{keywordtype}{float}ing\_po\textcolor{keywordtype}{int}\_v<T>,\ \textcolor{keywordtype}{int}>\ =\ 0>}
\DoxyCodeLine{00076\ \textcolor{keyword}{inline}\ T\ \mbox{\hyperlink{namespaceph_1_1math_a9e5d8a7a977115813ceeba3f0c00cbdb}{clamp}}(\textcolor{keyword}{const}\ T\ value,\ \textcolor{keyword}{const}\ T\ lowerBound,\ \textcolor{keyword}{const}\ T\ upperBound)}
\DoxyCodeLine{00077\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keywordflow}{return}\ std::min(upperBound,\ std::max(value,\ lowerBound));}
\DoxyCodeLine{00079\ \}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00083\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ std::enable\_if\_t<std::is\_\textcolor{keywordtype}{float}ing\_po\textcolor{keywordtype}{int}\_v<T>,\ \textcolor{keywordtype}{int}>\ =\ 0>}
\DoxyCodeLine{00084\ \textcolor{keyword}{inline}\ T\ \mbox{\hyperlink{namespaceph_1_1math_a9e5d8a7a977115813ceeba3f0c00cbdb}{clamp}}(\textcolor{keyword}{const}\ T\ value,\ \textcolor{keyword}{const}\ T\ lowerBound,\ \textcolor{keyword}{const}\ T\ upperBound)}
\DoxyCodeLine{00085\ \{}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keywordflow}{return}\ std::fmin(upperBound,\ std::fmax(value,\ lowerBound));}
\DoxyCodeLine{00087\ \}}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00091\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00092\ \textcolor{keyword}{inline}\ T\ \mbox{\hyperlink{namespaceph_1_1math_a3b5aeb6bb0f2f3339e033d34fa70a894}{to\_degrees}}(\textcolor{keyword}{const}\ T\ radians)}
\DoxyCodeLine{00093\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{keywordflow}{return}\ radians\ *\ (constant::rcp\_pi<T>\ *\ T(180));}
\DoxyCodeLine{00095\ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00099\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00100\ \textcolor{keyword}{inline}\ T\ \mbox{\hyperlink{namespaceph_1_1math_a8d924d614efcdd92fcce816a3f8eebf3}{to\_radians}}(\textcolor{keyword}{const}\ T\ degrees)}
\DoxyCodeLine{00101\ \{}
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{keywordflow}{return}\ degrees\ *\ (constant::pi<T>\ /\ T(180));}
\DoxyCodeLine{00103\ \}}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00112\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00113\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{namespaceph_1_1math_a7377d0dddd537e4e7a04f98bd8e1114e}{sign}}(\textcolor{keyword}{const}\ T\ value)}
\DoxyCodeLine{00114\ \{}
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0)\ <\ value)\ -\/\ (\textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(0)\ >\ value);}
\DoxyCodeLine{00116\ \}}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00125\ \textcolor{comment}{//\ TODO:\ templatize}}
\DoxyCodeLine{00126\ \textcolor{keyword}{inline}\ uint32\ \mbox{\hyperlink{namespaceph_1_1math_a2dd1eb154bffce7df042dbdd88aa161b}{next\_power\_of\_2}}(uint32\ value)}
\DoxyCodeLine{00127\ \{}
\DoxyCodeLine{00128\ \ \ \ \ PH\_ASSERT(value\ <=\ (1UL\ <<\ 31));}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \ \ \ \ -\/-\/value;}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \ \ value\ |=\ value\ >>\ 1;}
\DoxyCodeLine{00133\ \ \ \ \ value\ |=\ value\ >>\ 2;}
\DoxyCodeLine{00134\ \ \ \ \ value\ |=\ value\ >>\ 4;}
\DoxyCodeLine{00135\ \ \ \ \ value\ |=\ value\ >>\ 8;}
\DoxyCodeLine{00136\ \ \ \ \ value\ |=\ value\ >>\ 16;}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordflow}{return}\ value\ +\ 1;}
\DoxyCodeLine{00139\ \}}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00145\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00146\ \textcolor{keyword}{inline}\ T\ \mbox{\hyperlink{namespaceph_1_1math_aef693a3af48988419e383d739b935a4b}{log2\_floor}}(\textcolor{keyword}{const}\ T\ value)}
\DoxyCodeLine{00147\ \{}
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}(std::is\_floating\_point\_v<T>)}
\DoxyCodeLine{00149\ \ \ \ \ \{}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ PH\_ASSERT\_GT(value,\ T(0));}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(std::floor(std::log2(value)));}
\DoxyCodeLine{00153\ \ \ \ \ \}}
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00155\ \ \ \ \ \{}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \textcolor{keyword}{constexpr}\ T\ NUM\_BITS\ =\ \textcolor{keyword}{sizeof}(T)\ *\ CHAR\_BIT;}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_assert}(std::is\_integral\_v<T>);}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ PH\_ASSERT\_GT(value,\ T(0));}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \textcolor{preprocessor}{\#if\ PH\_COMPILER\_IS\_MSVC}}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ first1BitFromLeftIndex\ =\ std::numeric\_limits<unsigned\ long>::max();}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}(\textcolor{keyword}{sizeof}(T)\ <=\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}))}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ isIndexSet\ =\ \_BitScanReverse(}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&first1BitFromLeftIndex,\ }
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\textcolor{keyword}{>}(value));}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ \ \ PH\_ASSERT\_GT(isIndexSet,\ 0);}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_assert}(\textcolor{keyword}{sizeof}(T)\ <=\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ \_\_int64),}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}size\ of\ T\ is\ too\ large"{}});}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ isIndexSet\ =\ \_BitScanReverse64(}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&first1BitFromLeftIndex,\ }
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\ \_\_int64\textcolor{keyword}{>}(value));}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ PH\_ASSERT\_GT(isIndexSet,\ 0);}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ PH\_ASSERT\_IN\_RANGE\_INCLUSIVE(first1BitFromLeftIndex,\ T(0),\ NUM\_BITS\ -\/\ 1);}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(first1BitFromLeftIndex);}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \textcolor{preprocessor}{\#elif\ PH\_COMPILER\_IS\_CLANG\ ||\ PH\_COMPILER\_IS\_GCC}}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}(\textcolor{keyword}{sizeof}(T)\ <=\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}))}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ numLeftZeros\ =\ \_\_builtin\_clz(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\textcolor{keyword}{>}(value));}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ int)\ *\ CHAR\_BIT\ -\/\ 1\ -\/\ numLeftZeros);}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}(\textcolor{keyword}{sizeof}(T)\ <=\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}))}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ numLeftZeros\ =\ \_\_builtin\_clzl(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\textcolor{keyword}{>}(value));}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ long)\ *\ CHAR\_BIT\ -\/\ 1\ -\/\ numLeftZeros);}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_assert}(\textcolor{keyword}{sizeof}(T)\ <=\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}),}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}size\ of\ T\ is\ too\ large"{}});}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ numLeftZeros\ =\ \_\_builtin\_clzll(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\textcolor{keyword}{>}(value));}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ long)\ *\ CHAR\_BIT\ -\/\ 1\ -\/\ numLeftZeros);}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00207\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00208\ \ \ \ \ \}}
\DoxyCodeLine{00209\ \}}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00217\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ std::enable\_if\_t<std::is\_\textcolor{keywordtype}{float}ing\_po\textcolor{keywordtype}{int}\_v<T>,\ \textcolor{keywordtype}{int}>\ =\ 0>}
\DoxyCodeLine{00218\ \textcolor{keyword}{inline}\ T\ \mbox{\hyperlink{namespaceph_1_1math_a9460c87b6dab3097ee4d084d9b59a604}{fractional\_part}}(\textcolor{keyword}{const}\ T\ value)}
\DoxyCodeLine{00219\ \{}
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}\ integralPart;}
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(std::modf(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}\textcolor{keyword}{>}(value),\ \&integralPart));}
\DoxyCodeLine{00222\ \}}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00228\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ std::enable\_if\_t<std::is\_\textcolor{keywordtype}{int}egral\_v<T>,\ \textcolor{keywordtype}{int}>\ =\ 0>}
\DoxyCodeLine{00229\ \textcolor{keyword}{inline}\ T\ \mbox{\hyperlink{namespaceph_1_1math_a48cf078fd719072dfc9c27d67a730c3c}{wrap}}(T\ value,\ \textcolor{keyword}{const}\ T\ lowerBound,\ \textcolor{keyword}{const}\ T\ upperBound)}
\DoxyCodeLine{00230\ \{}
\DoxyCodeLine{00231\ \ \ \ \ PH\_ASSERT\_GE(upperBound,\ lowerBound);}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \ \ \ \ \textcolor{keyword}{const}\ T\ rangeSize\ =\ upperBound\ -\/\ lowerBound\ +\ \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1);}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00235\ \ \ \ \ \textcolor{keywordflow}{if}(value\ <\ lowerBound)}
\DoxyCodeLine{00236\ \ \ \ \ \{}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ value\ +=\ rangeSize\ *\ ((lowerBound\ -\/\ value)\ /\ rangeSize\ +\ \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(1));}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Possibly\ fail\ if\ <value>\ overflow}}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ PH\_ASSERT\_GE(value,\ lowerBound);}
\DoxyCodeLine{00241\ \ \ \ \ \}}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00243\ \ \ \ \ \textcolor{keywordflow}{return}\ lowerBound\ +\ (value\ -\/\ lowerBound)\ \%\ rangeSize;}
\DoxyCodeLine{00244\ \}}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00250\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00251\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespaceph_1_1math_a3d787dce79dfdd2614927831c40ab231}{is\_even}}(\textcolor{keyword}{const}\ T\ value)}
\DoxyCodeLine{00252\ \{}
\DoxyCodeLine{00253\ \ \ \ \ \textcolor{keyword}{static\_assert}(std::is\_integral\_v<T>,}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}T\ must\ be\ an\ integer\ type."{}});}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ \ \ \textcolor{keywordflow}{return}\ value\ \%\ 2\ ==\ 0;}
\DoxyCodeLine{00257\ \}}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00263\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00264\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespaceph_1_1math_a00dacdca0d6501e4506f1e80350c6529}{is\_odd}}(\textcolor{keyword}{const}\ T\ value)}
\DoxyCodeLine{00265\ \{}
\DoxyCodeLine{00266\ \ \ \ \ \textcolor{keywordflow}{return}\ !\mbox{\hyperlink{namespaceph_1_1math_a3d787dce79dfdd2614927831c40ab231}{is\_even}}(value);}
\DoxyCodeLine{00267\ \}}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00269\ \textcolor{comment}{//\ Checks\ whether\ the\ specified\ vector\ is\ within\ the\ hemisphere\ defined\ by}}
\DoxyCodeLine{00270\ \textcolor{comment}{//\ the\ normal\ vector\ N.\ N\ points\ to\ the\ hemisphere's\ peak,\ i.e.,\ theta\ =\ 0.}}
\DoxyCodeLine{00271\ \textcolor{comment}{//}}
\DoxyCodeLine{00272\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespaceph_1_1math_a885a24bd55e37b45410ec47a89bfb55e}{is\_same\_hemisphere}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classph_1_1math_1_1_t_vector3}{Vector3R}}\&\ vector,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classph_1_1math_1_1_t_vector3}{Vector3R}}\&\ N);}
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00276\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00277\ \textcolor{keyword}{inline}\ T\ \mbox{\hyperlink{namespaceph_1_1math_a536816208c239c8b2e217d70d5ec5d08}{product}}(\textcolor{keyword}{const}\ std::vector<T>\&\ values)}
\DoxyCodeLine{00278\ \{}
\DoxyCodeLine{00279\ \ \ \ \ T\ result(1);}
\DoxyCodeLine{00280\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\&\&\ value\ :\ values)}
\DoxyCodeLine{00281\ \ \ \ \ \{}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ result\ *=\ value;}
\DoxyCodeLine{00283\ \ \ \ \ \}}
\DoxyCodeLine{00284\ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00285\ \}}
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00287\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ NumberType>}
\DoxyCodeLine{00288\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ NumberType\ \mbox{\hyperlink{namespaceph_1_1math_adb4811e9be6e476d37c2db92e3d5a17a}{bytes\_to\_KiB}}(\textcolor{keyword}{const}\ std::size\_t\ numBytes)}
\DoxyCodeLine{00289\ \{}
\DoxyCodeLine{00290\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}NumberType\textcolor{keyword}{>}(numBytes)\ /\ \textcolor{keyword}{static\_cast<}NumberType\textcolor{keyword}{>}(\mbox{\hyperlink{namespaceph_1_1math_1_1constant_aec2814da28a7c9f64c26e54b610e2004}{constant::KiB}});}
\DoxyCodeLine{00291\ \}}
\DoxyCodeLine{00292\ }
\DoxyCodeLine{00293\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ NumberType>}
\DoxyCodeLine{00294\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ NumberType\ \mbox{\hyperlink{namespaceph_1_1math_a510bcaf07562b67f8897a55701399305}{bytes\_to\_MiB}}(\textcolor{keyword}{const}\ std::size\_t\ numBytes)}
\DoxyCodeLine{00295\ \{}
\DoxyCodeLine{00296\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}NumberType\textcolor{keyword}{>}(numBytes)\ /\ \textcolor{keyword}{static\_cast<}NumberType\textcolor{keyword}{>}(\mbox{\hyperlink{namespaceph_1_1math_1_1constant_a49ad38be8f3ddda440960e50cb5376db}{constant::MiB}});}
\DoxyCodeLine{00297\ \}}
\DoxyCodeLine{00298\ }
\DoxyCodeLine{00299\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ NumberType>}
\DoxyCodeLine{00300\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ NumberType\ \mbox{\hyperlink{namespaceph_1_1math_a2da02d8fd55ff426905d97c7297a08ad}{bytes\_to\_GiB}}(\textcolor{keyword}{const}\ std::size\_t\ numBytes)}
\DoxyCodeLine{00301\ \{}
\DoxyCodeLine{00302\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}NumberType\textcolor{keyword}{>}(numBytes)\ /\ \textcolor{keyword}{static\_cast<}NumberType\textcolor{keyword}{>}(\mbox{\hyperlink{namespaceph_1_1math_1_1constant_a5bd138de6e1289a88b5cc6109b0c6bda}{constant::GiB}});}
\DoxyCodeLine{00303\ \}}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00305\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ NumberType>}
\DoxyCodeLine{00306\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ NumberType\ \mbox{\hyperlink{namespaceph_1_1math_a37422f0d5ec9007755a40521c7bbf89d}{bytes\_to\_TiB}}(\textcolor{keyword}{const}\ std::size\_t\ numBytes)}
\DoxyCodeLine{00307\ \{}
\DoxyCodeLine{00308\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}NumberType\textcolor{keyword}{>}(numBytes)\ /\ \textcolor{keyword}{static\_cast<}NumberType\textcolor{keyword}{>}(\mbox{\hyperlink{namespaceph_1_1math_1_1constant_ac0d72c7c9b2610bd4c5b18bd289a48a9}{constant::TiB}});}
\DoxyCodeLine{00309\ \}}
\DoxyCodeLine{00310\ }
\DoxyCodeLine{00311\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ NumberType>}
\DoxyCodeLine{00312\ \textcolor{keyword}{inline}\ \textcolor{keyword}{constexpr}\ NumberType\ \mbox{\hyperlink{namespaceph_1_1math_aabf2fd737aa55c1ff9ca0f2315eca5e2}{bytes\_to\_PiB}}(\textcolor{keyword}{const}\ std::size\_t\ numBytes)}
\DoxyCodeLine{00313\ \{}
\DoxyCodeLine{00314\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}NumberType\textcolor{keyword}{>}(numBytes)\ /\ \textcolor{keyword}{static\_cast<}NumberType\textcolor{keyword}{>}(\mbox{\hyperlink{namespaceph_1_1math_1_1constant_a6ada2c0aedc92f05b605e2fd6daf63e7}{constant::PiB}});}
\DoxyCodeLine{00315\ \}}
\DoxyCodeLine{00316\ }
\DoxyCodeLine{00322\ \textcolor{comment}{//\ TODO:\ it\ is\ possible\ to\ generalize\ to\ signed\ range}}
\DoxyCodeLine{00323\ \textcolor{comment}{//\ \ \ \ \ \ \ maybe\ use\ ith\_evenly\_divided\_size()\ as\ function\ name\ and\ }}
\DoxyCodeLine{00324\ \textcolor{comment}{//\ \ \ \ \ \ \ ith\_evenly\_divided\_range()\ for\ signed/unsigned\ range}}
\DoxyCodeLine{00325\ \textcolor{keyword}{inline}\ std::pair<std::size\_t,\ std::size\_t>\ \mbox{\hyperlink{namespaceph_1_1math_a830bc8cab76b0720b0756fce21828b3f}{ith\_evenly\_divided\_range}}(}
\DoxyCodeLine{00326\ \ \ \ \ \textcolor{keyword}{const}\ std::size\_t\ rangeIndex,\ }
\DoxyCodeLine{00327\ \ \ \ \ \textcolor{keyword}{const}\ std::size\_t\ totalSize,}
\DoxyCodeLine{00328\ \ \ \ \ \textcolor{keyword}{const}\ std::size\_t\ numDivisions)}
\DoxyCodeLine{00329\ \{}
\DoxyCodeLine{00330\ \ \ \ \ PH\_ASSERT\_GT(numDivisions,\ 0);}
\DoxyCodeLine{00331\ \ \ \ \ PH\_ASSERT\_LT(rangeIndex,\ numDivisions);}
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00333\ \ \ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{00334\ \ \ \ \ \{}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ rangeIndex\ *\ totalSize\ /\ numDivisions,}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ (rangeIndex\ +\ 1)\ *\ totalSize\ /\ numDivisions}
\DoxyCodeLine{00337\ \ \ \ \ \};}
\DoxyCodeLine{00338\ \}}
\DoxyCodeLine{00339\ }
\DoxyCodeLine{00349\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{namespaceph_1_1math_acc970fbe8bc77521af0103b29e524baa}{fast\_rcp\_sqrt}}(\textcolor{keywordtype}{float}\ x)}
\DoxyCodeLine{00350\ \{}
\DoxyCodeLine{00351\ \ \ \ \ \textcolor{comment}{//\ TODO:\ }}
\DoxyCodeLine{00352\ \ \ \ \ \textcolor{comment}{//\ 1.\ implement\ double\ version\ in\ the\ reference\ paper\ and\ templatize\ iteration\ step}}
\DoxyCodeLine{00353\ \ \ \ \ \textcolor{comment}{//\ 2.\ is\ more\ iteration\ steps\ better\ than\ doing\ it\ in\ double}}
\DoxyCodeLine{00354\ \ \ \ \ \textcolor{comment}{//\ 3.\ establish\ a\ standard,\ e.g.,\ fast\_<X>()\ is\ guaranteed\ to\ have\ max.\ rel.\ error\ <\ 1\%}}
\DoxyCodeLine{00355\ }
\DoxyCodeLine{00356\ \ \ \ \ PH\_ASSERT\_GT(x,\ 0.0f);}
\DoxyCodeLine{00357\ }
\DoxyCodeLine{00358\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ halvedInput\ =\ 0.5f\ *\ x;}
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00360\ \ \ \ \ \textcolor{comment}{//\ Gives\ initial\ guess\ for\ later\ refinements}}
\DoxyCodeLine{00361\ \ \ \ \ \textcolor{keyword}{auto}\ bits\ =\ bitwise\_cast<std::uint32\_t>(x);}
\DoxyCodeLine{00362\ \ \ \ \ bits\ =\ 0x5F375A86\ -\/\ (bits\ >>\ 1);}
\DoxyCodeLine{00363\ \ \ \ \ x\ =\ bitwise\_cast<float>(bits);}
\DoxyCodeLine{00364\ }
\DoxyCodeLine{00365\ \ \ \ \ \textcolor{comment}{//\ Newton's\ method,\ each\ iteration\ increases\ accuracy.}}
\DoxyCodeLine{00366\ }
\DoxyCodeLine{00367\ \ \ \ \ \textcolor{comment}{//\ Iteration\ 1,\ max.\ relative\ error\ <\ 0.175125\%}}
\DoxyCodeLine{00368\ \ \ \ \ x\ =\ x\ *\ (1.5f\ -\/\ halvedInput\ *\ x\ *\ x);}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00370\ \ \ \ \ \textcolor{comment}{//\ Iteration\ 2,\ disabled\ since\ <x>\ is\ already\ good\ enough}}
\DoxyCodeLine{00371\ \ \ \ \ \textcolor{comment}{//x\ =\ x\ *\ (1.5f\ -\/\ halvedInput\ *\ x\ *\ x);}}
\DoxyCodeLine{00372\ }
\DoxyCodeLine{00373\ \ \ \ \ \textcolor{keywordflow}{return}\ x;}
\DoxyCodeLine{00374\ \}}
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00378\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{namespaceph_1_1math_adb93254f78909d9fef4bc8d7326b7670}{fast\_sqrt}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ x)}
\DoxyCodeLine{00379\ \{}
\DoxyCodeLine{00380\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespaceph_1_1math_acc970fbe8bc77521af0103b29e524baa}{fast\_rcp\_sqrt}}(x)\ *\ x;}
\DoxyCodeLine{00381\ \}}
\DoxyCodeLine{00382\ }
\DoxyCodeLine{00389\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ \textcolor{keyword}{typename}\ =\ std::enable\_if\_t<std::is\_\textcolor{keywordtype}{int}egral\_v<T>>>}
\DoxyCodeLine{00390\ \textcolor{keyword}{inline}\ T\ \mbox{\hyperlink{namespaceph_1_1math_a2cf56679844b291df412ba311723c828}{reverse\_bits}}(\textcolor{keyword}{const}\ T\ value)}
\DoxyCodeLine{00391\ \{}
\DoxyCodeLine{00392\ \ \ \ \ \textcolor{keyword}{using\ namespace\ }detail;}
\DoxyCodeLine{00393\ }
\DoxyCodeLine{00394\ \ \ \ \ \textcolor{keyword}{static\_assert}(std::is\_integral\_v<T>\ \&\&\ std::is\_unsigned\_v<T>,}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Unsupported\ type\ detected"{}});}
\DoxyCodeLine{00396\ }
\DoxyCodeLine{00397\ \ \ \ \ \textcolor{keyword}{constexpr}\ std::size\_t\ NUM\_BITS\ =\ \textcolor{keyword}{sizeof}(T)\ *\ CHAR\_BIT;}
\DoxyCodeLine{00398\ }
\DoxyCodeLine{00399\ \ \ \ \ \textcolor{comment}{//\ Note\ that\ arbitrary\ number\ of\ bits\ can\ be\ supported\ by\ careful\ handling\ of\ bitwise\ operations}}
\DoxyCodeLine{00400\ \ \ \ \ \textcolor{keyword}{static\_assert}(NUM\_BITS\ \%\ 8\ ==\ 0,}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Non-\/multiple-\/of-\/8\ integer\ bits\ are\ not\ supported"{}});}
\DoxyCodeLine{00402\ }
\DoxyCodeLine{00403\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}(NUM\_BITS\ ==\ 8)}
\DoxyCodeLine{00404\ \ \ \ \ \{}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ T(\mbox{\hyperlink{namespaceph_1_1math_1_1detail_a8b1da491334c7a82b2312b3fce5c1278}{detail::BITS8\_REVERSE\_TABLE}}[value]);}
\DoxyCodeLine{00406\ \ \ \ \ \}}
\DoxyCodeLine{00407\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}(NUM\_BITS\ ==\ 16)}
\DoxyCodeLine{00408\ \ \ \ \ \{}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1detail_a8b1da491334c7a82b2312b3fce5c1278}{detail::BITS8\_REVERSE\_TABLE}}[value\ \ \ \ \ \ \ \ \&\ 0xFF])\ <<\ 8)\ |}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1detail_a8b1da491334c7a82b2312b3fce5c1278}{detail::BITS8\_REVERSE\_TABLE}}[(value\ >>\ 8)\ \&\ 0xFF]));}
\DoxyCodeLine{00411\ \ \ \ \ \}}
\DoxyCodeLine{00412\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}(NUM\_BITS\ ==\ 32)}
\DoxyCodeLine{00413\ \ \ \ \ \{}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1detail_a8b1da491334c7a82b2312b3fce5c1278}{detail::BITS8\_REVERSE\_TABLE}}[value\ \ \ \ \ \ \ \ \ \&\ 0xFF])\ <<\ 24)\ |}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1detail_a8b1da491334c7a82b2312b3fce5c1278}{detail::BITS8\_REVERSE\_TABLE}}[(value\ >>\ 8)\ \ \&\ 0xFF])\ <<\ 16)\ |}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1detail_a8b1da491334c7a82b2312b3fce5c1278}{detail::BITS8\_REVERSE\_TABLE}}[(value\ >>\ 16)\ \&\ 0xFF])\ <<\ 8)\ \ |}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1detail_a8b1da491334c7a82b2312b3fce5c1278}{detail::BITS8\_REVERSE\_TABLE}}[(value\ >>\ 24)\ \&\ 0xFF]));}
\DoxyCodeLine{00418\ \ \ \ \ \}}
\DoxyCodeLine{00419\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00420\ \ \ \ \ \{}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_assert}(NUM\_BITS\ ==\ 64);}
\DoxyCodeLine{00422\ }
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1detail_a8b1da491334c7a82b2312b3fce5c1278}{detail::BITS8\_REVERSE\_TABLE}}[value\ \ \ \ \ \ \ \ \ \&\ 0xFF])\ <<\ 56)\ |}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1detail_a8b1da491334c7a82b2312b3fce5c1278}{detail::BITS8\_REVERSE\_TABLE}}[(value\ >>\ 8)\ \ \&\ 0xFF])\ <<\ 48)\ |}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1detail_a8b1da491334c7a82b2312b3fce5c1278}{detail::BITS8\_REVERSE\_TABLE}}[(value\ >>\ 16)\ \&\ 0xFF])\ <<\ 40)\ |}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1detail_a8b1da491334c7a82b2312b3fce5c1278}{detail::BITS8\_REVERSE\_TABLE}}[(value\ >>\ 24)\ \&\ 0xFF])\ <<\ 32)\ |}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1detail_a8b1da491334c7a82b2312b3fce5c1278}{detail::BITS8\_REVERSE\_TABLE}}[(value\ >>\ 32)\ \&\ 0xFF])\ <<\ 24)\ |}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1detail_a8b1da491334c7a82b2312b3fce5c1278}{detail::BITS8\_REVERSE\_TABLE}}[(value\ >>\ 40)\ \&\ 0xFF])\ <<\ 16)\ |}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1detail_a8b1da491334c7a82b2312b3fce5c1278}{detail::BITS8\_REVERSE\_TABLE}}[(value\ >>\ 48)\ \&\ 0xFF])\ <<\ 8)\ \ |}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (T(\mbox{\hyperlink{namespaceph_1_1math_1_1detail_a8b1da491334c7a82b2312b3fce5c1278}{detail::BITS8\_REVERSE\_TABLE}}[(value\ >>\ 56)\ \&\ 0xFF]));}
\DoxyCodeLine{00431\ \ \ \ \ \}}
\DoxyCodeLine{00432\ \}}
\DoxyCodeLine{00433\ }
\DoxyCodeLine{00438\ \textcolor{keyword}{template}<std::\textcolor{keywordtype}{unsigned}\_\textcolor{keywordtype}{int}egral\ UIntType,\ std::\textcolor{keywordtype}{int}egral\ RangeType>}
\DoxyCodeLine{00439\ \textcolor{keyword}{inline}\ UIntType\ \mbox{\hyperlink{namespaceph_1_1math_abbf29a619bc4b2cd6e88bbc5e3380a0f}{set\_bits\_in\_range}}(\textcolor{keyword}{const}\ UIntType\ bits,\ \textcolor{keyword}{const}\ RangeType\ beginBitIdx,\ \textcolor{keyword}{const}\ RangeType\ endBitIdx)}
\DoxyCodeLine{00440\ \{}
\DoxyCodeLine{00441\ \ \ \ \ \textcolor{comment}{//\ Inclusive\ as\ empty\ range\ is\ allowed,\ e.g.,\ \`{}beginBitIdx`\ ==\ \`{}endBitIdx`}}
\DoxyCodeLine{00442\ \ \ \ \ PH\_ASSERT\_IN\_RANGE\_INCLUSIVE(beginBitIdx,\ 0,\ endBitIdx);}
\DoxyCodeLine{00443\ \ \ \ \ PH\_ASSERT\_IN\_RANGE\_INCLUSIVE(endBitIdx,\ beginBitIdx,\ sizeof\_in\_bits<UIntType>());}
\DoxyCodeLine{00444\ }
\DoxyCodeLine{00445\ \ \ \ \ \textcolor{comment}{//\ Mask\ for\ the\ bits\ in\ range.\ Constructed\ by\ producing\ required\ number\ of\ 1's\ then\ shift}}
\DoxyCodeLine{00446\ \ \ \ \ \textcolor{comment}{//\ by\ <beginBitIdx>.\ }}
\DoxyCodeLine{00447\ \ \ \ \ \textcolor{comment}{//\ Note\ that\ if\ there\ is\ integer\ promotion\ to\ signed\ types,\ it\ should\ be\ fine-\/-\/promoted\ type}}
\DoxyCodeLine{00448\ \ \ \ \ \textcolor{comment}{//\ must\ be\ wider\ than\ the\ original\ unsigned\ type,\ the\ bit\ shifts\ will\ never\ reach\ sign\ bit.\ }}
\DoxyCodeLine{00449\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00450\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ bitMask\ =\ \textcolor{keyword}{static\_cast<}UIntType\textcolor{keyword}{>}(((UIntType(1)\ <<\ (endBitIdx\ -\/\ beginBitIdx))\ -\/\ 1)\ <<\ beginBitIdx);}
\DoxyCodeLine{00451\ }
\DoxyCodeLine{00452\ \ \ \ \ \textcolor{keywordflow}{return}\ bits\ |\ bitMask;}
\DoxyCodeLine{00453\ \}}
\DoxyCodeLine{00454\ }
\DoxyCodeLine{00459\ \textcolor{keyword}{template}<std::\textcolor{keywordtype}{unsigned}\_\textcolor{keywordtype}{int}egral\ UIntType,\ std::\textcolor{keywordtype}{int}egral\ RangeType>}
\DoxyCodeLine{00460\ \textcolor{keyword}{inline}\ UIntType\ \mbox{\hyperlink{namespaceph_1_1math_af11f191a13f32e5ff37ba539bb731029}{clear\_bits\_in\_range}}(\textcolor{keyword}{const}\ UIntType\ bits,\ \textcolor{keyword}{const}\ RangeType\ beginBitIdx,\ \textcolor{keyword}{const}\ RangeType\ endBitIdx)}
\DoxyCodeLine{00461\ \{}
\DoxyCodeLine{00462\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ bitMask\ =\ set\_bits\_in\_range<UIntType,\ RangeType>(UIntType(0),\ beginBitIdx,\ endBitIdx);}
\DoxyCodeLine{00463\ \ \ \ \ \textcolor{keywordflow}{return}\ bits\ \&\ (\string~bitMask);}
\DoxyCodeLine{00464\ \}}
\DoxyCodeLine{00465\ }
\DoxyCodeLine{00470\ \textcolor{keyword}{template}<std::\textcolor{keywordtype}{unsigned}\_\textcolor{keywordtype}{int}egral\ UIntType>}
\DoxyCodeLine{00471\ \textcolor{keyword}{inline}\ UIntType\ \mbox{\hyperlink{namespaceph_1_1math_a00c7265b62195ee8215d3a07ee97d8a6}{flag\_bit}}(\textcolor{keyword}{const}\ UIntType\ bitIdx)}
\DoxyCodeLine{00472\ \{}
\DoxyCodeLine{00473\ \ \ \ \ PH\_ASSERT\_IN\_RANGE(bitIdx,\ 0,\ sizeof\_in\_bits<UIntType>());}
\DoxyCodeLine{00474\ }
\DoxyCodeLine{00475\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}UIntType\textcolor{keyword}{>}(1)\ <<\ bitIdx;}
\DoxyCodeLine{00476\ \}}
\DoxyCodeLine{00477\ }
\DoxyCodeLine{00478\ \textcolor{keyword}{template}<std::\textcolor{keywordtype}{unsigned}\_\textcolor{keywordtype}{int}egral\ UIntType,\ UIntType\ BIT\_IDX>}
\DoxyCodeLine{00479\ \textcolor{keyword}{inline}\ \textcolor{keyword}{consteval}\ UIntType\ \mbox{\hyperlink{namespaceph_1_1math_a00c7265b62195ee8215d3a07ee97d8a6}{flag\_bit}}()}
\DoxyCodeLine{00480\ \{}
\DoxyCodeLine{00481\ \ \ \ \ \textcolor{keyword}{static\_assert}(0\ <=\ BIT\_IDX\ \&\&\ BIT\_IDX\ <\ sizeof\_in\_bits<UIntType>(),}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}BIT\_IDX\ must\ be\ within\ [0,\ \#\ bits\ in\ UIntType)"{}});}
\DoxyCodeLine{00483\ }
\DoxyCodeLine{00484\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}UIntType\textcolor{keyword}{>}(1)\ <<\ BIT\_IDX;}
\DoxyCodeLine{00485\ \}}
\DoxyCodeLine{00487\ }
\DoxyCodeLine{00488\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ T\ MIN,\ T\ MAX,\ std::\textcolor{keywordtype}{size\_t}\ N>}
\DoxyCodeLine{00489\ \textcolor{keyword}{inline}\ std::array<T,\ N>\ \mbox{\hyperlink{namespaceph_1_1math_a5ffba8a0fe5af3a10b2b568ff3f26124}{evenly\_spaced\_array}}()}
\DoxyCodeLine{00490\ \{}
\DoxyCodeLine{00491\ \ \ \ \ \textcolor{keyword}{static\_assert}(\mbox{\hyperlink{namespaceph_1_1math_ae7853802be4d35a3625b5f313151d1baa26a4b44a837bf97b972628509912b4a5}{MAX}}\ >\ \mbox{\hyperlink{namespaceph_1_1math_ae7853802be4d35a3625b5f313151d1baace31e2a082d17e038fcc6e3006166653}{MIN}});}
\DoxyCodeLine{00492\ \ \ \ \ \textcolor{keyword}{static\_assert}(N\ >=\ 2);}
\DoxyCodeLine{00493\ }
\DoxyCodeLine{00494\ \ \ \ \ \textcolor{keyword}{constexpr}\ T\ TOTAL\_SIZE\ =\ \mbox{\hyperlink{namespaceph_1_1math_ae7853802be4d35a3625b5f313151d1baa26a4b44a837bf97b972628509912b4a5}{MAX}}\ -\/\ \mbox{\hyperlink{namespaceph_1_1math_ae7853802be4d35a3625b5f313151d1baace31e2a082d17e038fcc6e3006166653}{MIN}};}
\DoxyCodeLine{00495\ }
\DoxyCodeLine{00496\ \ \ \ \ std::array<T,\ N>\ arr;}
\DoxyCodeLine{00497\ \ \ \ \ arr[0]\ =\ \mbox{\hyperlink{namespaceph_1_1math_ae7853802be4d35a3625b5f313151d1baace31e2a082d17e038fcc6e3006166653}{MIN}};}
\DoxyCodeLine{00498\ \ \ \ \ \textcolor{keywordflow}{for}(std::size\_t\ i\ =\ 1;\ i\ <\ N\ -\/\ 1;\ ++i)}
\DoxyCodeLine{00499\ \ \ \ \ \{}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ current\ fraction\ i/(N-\/1),\ and\ multiply\ it\ with\ the\ total\ size}}
\DoxyCodeLine{00501\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ (we\ multiply\ total\ size\ with\ i\ fist,\ otherwise\ integral\ types\ will\ always\ result\ in\ 0)}}
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ arr[i]\ =\ \mbox{\hyperlink{namespaceph_1_1math_ae7853802be4d35a3625b5f313151d1baace31e2a082d17e038fcc6e3006166653}{MIN}}\ +\ \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(i\ *\ TOTAL\_SIZE\ /\ (N\ -\/\ 1));}
\DoxyCodeLine{00503\ }
\DoxyCodeLine{00504\ \ \ \ \ \ \ \ \ PH\_ASSERT\_IN\_RANGE\_INCLUSIVE(arr[i],\ \mbox{\hyperlink{namespaceph_1_1math_ae7853802be4d35a3625b5f313151d1baace31e2a082d17e038fcc6e3006166653}{MIN}},\ \mbox{\hyperlink{namespaceph_1_1math_ae7853802be4d35a3625b5f313151d1baa26a4b44a837bf97b972628509912b4a5}{MAX}});}
\DoxyCodeLine{00505\ \ \ \ \ \}}
\DoxyCodeLine{00506\ \ \ \ \ arr[N\ -\/\ 1]\ =\ \mbox{\hyperlink{namespaceph_1_1math_ae7853802be4d35a3625b5f313151d1baa26a4b44a837bf97b972628509912b4a5}{MAX}};}
\DoxyCodeLine{00507\ }
\DoxyCodeLine{00508\ \ \ \ \ \textcolor{keywordflow}{return}\ arr;}
\DoxyCodeLine{00509\ \}}
\DoxyCodeLine{00510\ }
\DoxyCodeLine{00511\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00512\ \textcolor{keyword}{inline}\ std::vector<T>\ \mbox{\hyperlink{namespaceph_1_1math_a95653bcb43b37e51af4fe120f25e9099}{evenly\_spaced\_vector}}(\textcolor{keyword}{const}\ T\ min,\ \textcolor{keyword}{const}\ T\ max,\ \textcolor{keyword}{const}\ std::size\_t\ n)}
\DoxyCodeLine{00513\ \{}
\DoxyCodeLine{00514\ \ \ \ \ PH\_ASSERT\_GT(max,\ min);}
\DoxyCodeLine{00515\ \ \ \ \ PH\_ASSERT\_GE(n,\ 2);}
\DoxyCodeLine{00516\ }
\DoxyCodeLine{00517\ \ \ \ \ \textcolor{keyword}{const}\ T\ totalSize\ =\ max\ -\/\ min;}
\DoxyCodeLine{00518\ }
\DoxyCodeLine{00519\ \ \ \ \ std::vector<T>\ vec(n,\ 0);}
\DoxyCodeLine{00520\ \ \ \ \ vec[0]\ =\ min;}
\DoxyCodeLine{00521\ \ \ \ \ \textcolor{keywordflow}{for}(std::size\_t\ i\ =\ 0;\ i\ <\ n;\ ++i)}
\DoxyCodeLine{00522\ \ \ \ \ \{}
\DoxyCodeLine{00523\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ current\ fraction\ i/(n-\/1),\ and\ multiply\ it\ with\ the\ total\ size}}
\DoxyCodeLine{00524\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ (we\ multiply\ total\ size\ with\ i\ fist,\ otherwise\ integral\ types\ will\ always\ result\ in\ 0)}}
\DoxyCodeLine{00525\ \ \ \ \ \ \ \ \ vec[i]\ =\ min\ +\ \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(i\ *\ totalSize\ /\ (n\ -\/\ 1));}
\DoxyCodeLine{00526\ }
\DoxyCodeLine{00527\ \ \ \ \ \ \ \ \ PH\_ASSERT\_IN\_RANGE\_INCLUSIVE(vec[i],\ min,\ max);}
\DoxyCodeLine{00528\ \ \ \ \ \}}
\DoxyCodeLine{00529\ \ \ \ \ vec[n\ -\/\ 1]\ =\ max;}
\DoxyCodeLine{00530\ \ \ \ \ \textcolor{keywordflow}{return}\ vec;}
\DoxyCodeLine{00531\ \}}
\DoxyCodeLine{00532\ }
\DoxyCodeLine{00539\ \textcolor{comment}{//\ TODO:\ handle\ denormalized\ value\ and\ others\ (std::frexp\ seems\ interesting)}}
\DoxyCodeLine{00540\ \textcolor{comment}{//\ https://stackoverflow.com/questions/6162651/half-\/precision-\/floating-\/point-\/in-\/java}}
\DoxyCodeLine{00542\ }
\DoxyCodeLine{00544\ \textcolor{keyword}{inline}\ uint16\ \mbox{\hyperlink{namespaceph_1_1math_a91780ac8e52ddfdd3f0314cc36b882c2}{fp32\_to\_fp16\_bits}}(\textcolor{keyword}{const}\ float32\ value)}
\DoxyCodeLine{00545\ \{}
\DoxyCodeLine{00546\ \ \ \ \ \textcolor{keyword}{static\_assert}(std::numeric\_limits<float32>::is\_iec559);}
\DoxyCodeLine{00547\ }
\DoxyCodeLine{00548\ \ \ \ \ \textcolor{keywordflow}{if}(std::abs(value)\ <\ 0.0000610352f)}
\DoxyCodeLine{00549\ \ \ \ \ \{}
\DoxyCodeLine{00550\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::signbit(value)\ ?\ 0x8000\ :\ 0x0000;}
\DoxyCodeLine{00551\ \ \ \ \ \}}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00553\ \ \ \ \ uint16\ fp16Bits;}
\DoxyCodeLine{00554\ \ \ \ \ uint32\ fp32Bits;}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00556\ \ \ \ \ fp32Bits\ =\ std::bit\_cast<uint32>(value);}
\DoxyCodeLine{00557\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00558\ \ \ \ \ \textcolor{comment}{//\ truncate\ the\ mantissa\ and\ doing\ (exp\ -\/\ 127\ +\ 15)}}
\DoxyCodeLine{00559\ \ \ \ \ fp16Bits\ =\ \ \textcolor{keyword}{static\_cast<}uint16\textcolor{keyword}{>}((((fp32Bits\ \&\ 0x7FFFFFFF)\ >>\ 13)\ -\/\ (0x38000000\ >>\ 13)));}
\DoxyCodeLine{00560\ \ \ \ \ fp16Bits\ |=\ ((fp32Bits\ \&\ 0x80000000)\ >>\ 16);\textcolor{comment}{//\ sign}}
\DoxyCodeLine{00561\ }
\DoxyCodeLine{00562\ \ \ \ \ \textcolor{keywordflow}{return}\ fp16Bits;}
\DoxyCodeLine{00563\ \}}
\DoxyCodeLine{00564\ }
\DoxyCodeLine{00567\ \textcolor{keyword}{inline}\ float32\ \mbox{\hyperlink{namespaceph_1_1math_a050fd048afd360173b15c10a05c21f7c}{fp16\_bits\_to\_fp32}}(\textcolor{keyword}{const}\ uint16\ fp16Bits)}
\DoxyCodeLine{00568\ \{}
\DoxyCodeLine{00569\ \ \ \ \ \textcolor{keyword}{static\_assert}(std::numeric\_limits<float32>::is\_iec559);}
\DoxyCodeLine{00570\ }
\DoxyCodeLine{00571\ \ \ \ \ \textcolor{comment}{//\ 0\ if\ all\ bits\ other\ than\ the\ sign\ bit\ are\ 0}}
\DoxyCodeLine{00572\ \ \ \ \ \textcolor{keywordflow}{if}((fp16Bits\ \&\ 0x7FFF)\ ==\ 0)}
\DoxyCodeLine{00573\ \ \ \ \ \{}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (fp16Bits\ \&\ 0x8000)\ ==\ 0\ ?\ 0.0f\ :\ -\/0.0f;}
\DoxyCodeLine{00575\ \ \ \ \ \}}
\DoxyCodeLine{00576\ }
\DoxyCodeLine{00577\ \ \ \ \ uint32\ fp32Bits\ =\ ((fp16Bits\ \&\ 0x8000)\ <<\ 16);}
\DoxyCodeLine{00578\ \ \ \ \ fp32Bits\ |=\ (((fp16Bits\ \&\ 0x7FFF)\ <<\ 13)\ +\ 0x38000000);}
\DoxyCodeLine{00579\ }
\DoxyCodeLine{00580\ \ \ \ \ \textcolor{keywordflow}{return}\ std::bit\_cast<float32>(fp32Bits);}
\DoxyCodeLine{00581\ \}}
\DoxyCodeLine{00583\ }
\DoxyCodeLine{00589\ \textcolor{comment}{//\ TODO:\ numeric\ analysis}}
\DoxyCodeLine{00590\ \textcolor{comment}{//\ TODO:\ long\ double\ is\ not\ needed\ for\ shorter\ integer\ types}}
\DoxyCodeLine{00591\ \textcolor{keyword}{template}<std::\textcolor{keywordtype}{float}ing\_po\textcolor{keywordtype}{int}\ FloatType,\ std::\textcolor{keywordtype}{int}egral\ IntType>}
\DoxyCodeLine{00592\ \textcolor{keyword}{inline}\ FloatType\ \mbox{\hyperlink{namespaceph_1_1math_a4690860b243fe5e072ff6048732ae2a3}{normalize\_integer}}(\textcolor{keyword}{const}\ IntType\ intVal)}
\DoxyCodeLine{00593\ \{}
\DoxyCodeLine{00594\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}(std::is\_unsigned\_v<IntType>)}
\DoxyCodeLine{00595\ \ \ \ \ \{}
\DoxyCodeLine{00596\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}FloatType\textcolor{keyword}{>}(}
\DoxyCodeLine{00597\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}\textcolor{keyword}{>}(intVal)\ /\ std::numeric\_limits<IntType>::max());}
\DoxyCodeLine{00598\ \ \ \ \ \}}
\DoxyCodeLine{00599\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00600\ \ \ \ \ \{}
\DoxyCodeLine{00601\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}FloatType\textcolor{keyword}{>}(intVal\ >=\ 0}
\DoxyCodeLine{00602\ \ \ \ \ \ \ \ \ \ \ \ \ ?\ \ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}\textcolor{keyword}{>}(intVal)\ /\ std::numeric\_limits<IntType>::max()}
\DoxyCodeLine{00603\ \ \ \ \ \ \ \ \ \ \ \ \ :\ -\/\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}\textcolor{keyword}{>}(intVal)\ /\ std::numeric\_limits<IntType>::min());}
\DoxyCodeLine{00604\ \ \ \ \ \}}
\DoxyCodeLine{00605\ \}}
\DoxyCodeLine{00606\ }
\DoxyCodeLine{00607\ \textcolor{comment}{//\ TODO:\ numeric\ analysis}}
\DoxyCodeLine{00608\ \textcolor{comment}{//\ TODO:\ long\ double\ is\ not\ needed\ for\ shorter\ integer\ types}}
\DoxyCodeLine{00609\ \textcolor{keyword}{template}<std::\textcolor{keywordtype}{int}egral\ IntType,\ std::\textcolor{keywordtype}{float}ing\_po\textcolor{keywordtype}{int}\ FloatType>}
\DoxyCodeLine{00610\ \textcolor{keyword}{inline}\ IntType\ \mbox{\hyperlink{namespaceph_1_1math_a403680d6446383625398ed0c057c43fd}{quantize\_normalized\_float}}(\textcolor{keyword}{const}\ FloatType\ floatVal)}
\DoxyCodeLine{00611\ \{}
\DoxyCodeLine{00612\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}(std::is\_unsigned\_v<IntType>)}
\DoxyCodeLine{00613\ \ \ \ \ \{}
\DoxyCodeLine{00614\ \ \ \ \ \ \ \ \ PH\_ASSERT\_IN\_RANGE\_INCLUSIVE(floatVal,\ 0.0f,\ 1.0f);}
\DoxyCodeLine{00615\ }
\DoxyCodeLine{00616\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}IntType\textcolor{keyword}{>}(}
\DoxyCodeLine{00617\ \ \ \ \ \ \ \ \ \ \ \ \ std::round(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}\textcolor{keyword}{>}(floatVal)\ *\ std::numeric\_limits<IntType>::max()));}
\DoxyCodeLine{00618\ \ \ \ \ \}}
\DoxyCodeLine{00619\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00620\ \ \ \ \ \{}
\DoxyCodeLine{00621\ \ \ \ \ \ \ \ \ PH\_ASSERT\_IN\_RANGE\_INCLUSIVE(floatVal,\ -\/1.0f,\ 1.0f);}
\DoxyCodeLine{00622\ }
\DoxyCodeLine{00623\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}IntType\textcolor{keyword}{>}(floatVal\ >=\ 0}
\DoxyCodeLine{00624\ \ \ \ \ \ \ \ \ \ \ \ \ ?\ std::round(\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}\textcolor{keyword}{>}(floatVal)\ *\ std::numeric\_limits<IntType>::max())}
\DoxyCodeLine{00625\ \ \ \ \ \ \ \ \ \ \ \ \ :\ std::round(-\/\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{double}\textcolor{keyword}{>}(floatVal)\ *\ std::numeric\_limits<IntType>::min()));}
\DoxyCodeLine{00626\ \ \ \ \ \}}
\DoxyCodeLine{00627\ \}}
\DoxyCodeLine{00628\ }
\DoxyCodeLine{00633\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespaceph_1_1math_a996b8aaa152f5e58eea616b7340f7659}{uint64\_mul}}(\textcolor{keyword}{const}\ uint64\ lhs,\ \textcolor{keyword}{const}\ uint64\ rhs,\ uint64\&\ out\_high64,\ uint64\&\ out\_low64)}
\DoxyCodeLine{00634\ \{}
\DoxyCodeLine{00635\ \textcolor{preprocessor}{\#if\ defined(\_\_SIZEOF\_INT128\_\_)}}
\DoxyCodeLine{00636\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ result128\ =\ \_\_uint128\_t(lhs)\ +\ \_\_uint128\_t(rhs);}
\DoxyCodeLine{00637\ \ \ \ \ out\_high64\ =\ \textcolor{keyword}{static\_cast<}uint64\textcolor{keyword}{>}(result128\ >>\ 64);}
\DoxyCodeLine{00638\ \ \ \ \ out\_low64\ =\ \textcolor{keyword}{static\_cast<}uint64\textcolor{keyword}{>}(result128);}
\DoxyCodeLine{00639\ \textcolor{preprocessor}{\#elif\ PH\_COMPILER\_IS\_MSVC}}
\DoxyCodeLine{00640\ \ \ \ \ out\_low64\ =\ \_umul128(lhs,\ rhs,\ \&out\_high64);}
\DoxyCodeLine{00641\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00642\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00643\ \textcolor{comment}{\ \ \ \ Divide\ each\ 64-\/bit\ number\ into\ two\ 32-\/bit\ parts,\ then\ multiplying\ (or\ adding)\ any\ 32-\/bit}}
\DoxyCodeLine{00644\ \textcolor{comment}{\ \ \ \ pairs\ cannot\ overflow\ if\ done\ using\ 64-\/bit\ arithmetic.\ If\ we\ multiply\ them\ using\ base\ 2\string^32\ }}
\DoxyCodeLine{00645\ \textcolor{comment}{\ \ \ \ arithmetic,\ a\ total\ of\ 4\ products\ must\ be\ shifted\ and\ added\ to\ obtain\ the\ final\ result.\ }}
\DoxyCodeLine{00646\ \textcolor{comment}{\ \ \ \ Here\ is\ a\ simple\ illustration\ of\ the\ algorithm:}}
\DoxyCodeLine{00647\ \textcolor{comment}{}}
\DoxyCodeLine{00648\ \textcolor{comment}{\ \ \ \ lhs\ =\ [\ a\ ][\ b\ ]}}
\DoxyCodeLine{00649\ \textcolor{comment}{\ \ \ \ rhs\ =\ [\ c\ ][\ d\ ]}}
\DoxyCodeLine{00650\ \textcolor{comment}{}}
\DoxyCodeLine{00651\ \textcolor{comment}{\ \ \ \ Treat\ this\ like\ performing\ a\ regular\ multiplication\ on\ paper.\ Note\ that\ the\ multiplication}}
\DoxyCodeLine{00652\ \textcolor{comment}{\ \ \ \ is\ done\ in\ base\ 2\string^32:}}
\DoxyCodeLine{00653\ \textcolor{comment}{}}
\DoxyCodeLine{00654\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [\ a\ ][\ b\ ]}}
\DoxyCodeLine{00655\ \textcolor{comment}{\ \ \ \ \ \ x\ \ \ \ \ \ \ \ [\ c\ ][\ d\ ]}}
\DoxyCodeLine{00656\ \textcolor{comment}{\ \ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00657\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [a*d][b*d]}}
\DoxyCodeLine{00658\ \textcolor{comment}{\ \ \ \ \ \ +\ \ \ [a*c][b*c]}}
\DoxyCodeLine{00659\ \textcolor{comment}{\ \ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00660\ \textcolor{comment}{}}
\DoxyCodeLine{00661\ \textcolor{comment}{\ \ \ \ \ \ The\ overflowing\ part\ of\ each\ partial\ product\ is\ the\ carry\ (32-\/bit\ carry).\ This\ is\ a\ good\ reference:}}
\DoxyCodeLine{00662\ \textcolor{comment}{\ \ \ \ \ \ https://stackoverflow.com/questions/26852435/reasonably-\/portable-\/way-\/to-\/get-\/top-\/64-\/bits-\/from-\/64x64-\/bit-\/multiply}}
\DoxyCodeLine{00663\ \textcolor{comment}{\ \ \ \ */}}
\DoxyCodeLine{00664\ }
\DoxyCodeLine{00665\ \ \ \ \ \textcolor{keyword}{const}\ uint64\ a\ =\ lhs\ >>\ 32,\ b\ =\ lhs\ \&\ 0xFFFFFFFF;}
\DoxyCodeLine{00666\ \ \ \ \ \textcolor{keyword}{const}\ uint64\ c\ =\ rhs\ >>\ 32,\ d\ =\ rhs\ \&\ 0xFFFFFFFF;}
\DoxyCodeLine{00667\ }
\DoxyCodeLine{00668\ \ \ \ \ \textcolor{keyword}{const}\ uint64\ ac\ =\ a\ *\ c;}
\DoxyCodeLine{00669\ \ \ \ \ \textcolor{keyword}{const}\ uint64\ bc\ =\ b\ *\ c;}
\DoxyCodeLine{00670\ \ \ \ \ \textcolor{keyword}{const}\ uint64\ ad\ =\ a\ *\ d;}
\DoxyCodeLine{00671\ \ \ \ \ \textcolor{keyword}{const}\ uint64\ bd\ =\ b\ *\ d;}
\DoxyCodeLine{00672\ }
\DoxyCodeLine{00673\ \ \ \ \ \textcolor{comment}{//\ This\ is\ the\ middle\ part\ of\ the\ above\ illustration,\ which\ is\ a\ sum\ of\ three\ 32-\/bit\ numbers\ }}
\DoxyCodeLine{00674\ \ \ \ \ \textcolor{comment}{//\ (so\ it\ is\ 34-\/bit\ at\ most):\ two\ products\ b*c\ and\ a*d,\ and\ the\ carry\ from\ b*d}}
\DoxyCodeLine{00675\ \ \ \ \ \textcolor{keyword}{const}\ uint64\ mid34\ =\ (bd\ >>\ 32)\ +\ (bc\ \&\ 0xFFFFFFFF)\ +\ (ad\ \&\ 0xFFFFFFFF);}
\DoxyCodeLine{00676\ }
\DoxyCodeLine{00677\ \ \ \ \ out\_high64\ =\ ac\ +\ (bc\ >>\ 32)\ +\ (ad\ >>\ 32)\ +\ (mid34\ >>\ 32);}
\DoxyCodeLine{00678\ \ \ \ \ out\_low64\ =\ (mid34\ <<\ 32)\ |\ (bd\ \&\ 0xFFFFFFFF);}
\DoxyCodeLine{00679\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00680\ \}}
\DoxyCodeLine{00681\ }
\DoxyCodeLine{00682\ \}\textcolor{comment}{//\ end\ namespace\ ph::math}}

\end{DoxyCode}
