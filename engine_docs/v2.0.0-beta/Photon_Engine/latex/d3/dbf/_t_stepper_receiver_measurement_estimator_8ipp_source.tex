\doxysection{TStepper\+Receiver\+Measurement\+Estimator.\+ipp}
\hypertarget{_t_stepper_receiver_measurement_estimator_8ipp_source}{}\label{_t_stepper_receiver_measurement_estimator_8ipp_source}\index{Source/Core/Renderer/Sampling/TStepperReceiverMeasurementEstimator.ipp@{Source/Core/Renderer/Sampling/TStepperReceiverMeasurementEstimator.ipp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ "{}Core/Renderer/Sampling/TStepperReceiverMeasurementEstimator.h"{}}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ "{}Core/Estimator/IRayEnergyEstimator.h"{}}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceph}{ph}}}
\DoxyCodeLine{00007\ \{}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ SamplingFilmType,\ \textcolor{keyword}{typename}\ EstimationType>}
\DoxyCodeLine{00010\ \textcolor{keyword}{inline}\ TStepperReceiverMeasurementEstimator<SamplingFilmType,\ EstimationType>::}
\DoxyCodeLine{00011\ TStepperReceiverMeasurementEstimator(}
\DoxyCodeLine{00012\ \ \ \ \ \textcolor{keyword}{const}\ std::size\_t\ numFilms,}
\DoxyCodeLine{00013\ \ \ \ \ \textcolor{keyword}{const}\ std::size\_t\ numEstimations,}
\DoxyCodeLine{00014\ \ \ \ \ Integrand\ \ \ \ \ \ \ \ \ integrand,}
\DoxyCodeLine{00015\ \ \ \ \ SampleFilter\ \ \ \ \ \ filter)\ :\ }
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \ \ \ \ TReceiverMeasurementEstimator<SamplingFilmType,\ EstimationType>(}
\DoxyCodeLine{00018\ \ \ \ \ \ \ \ \ numFilms,}
\DoxyCodeLine{00019\ \ \ \ \ \ \ \ \ numEstimations,}
\DoxyCodeLine{00020\ \ \ \ \ \ \ \ \ std::move(integrand),}
\DoxyCodeLine{00021\ \ \ \ \ \ \ \ \ std::move(filter)),}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \ \ \ \ m\_filmStepSizes\ \ \ \ \ (numFilms,\ 1),}
\DoxyCodeLine{00024\ \ \ \ \ m\_currentBatchNumber(0)}
\DoxyCodeLine{00025\ \{\}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ SamplingFilmType,\ \textcolor{keyword}{typename}\ EstimationType>}
\DoxyCodeLine{00028\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ TStepperReceiverMeasurementEstimator<SamplingFilmType,\ EstimationType>::}
\DoxyCodeLine{00029\ onBatchStart(\textcolor{keyword}{const}\ uint64\ batchNumber)}
\DoxyCodeLine{00030\ \{}
\DoxyCodeLine{00031\ \ \ \ \ m\_currentBatchNumber\ =\ batchNumber;}
\DoxyCodeLine{00032\ \}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ SamplingFilmType,\ \textcolor{keyword}{typename}\ EstimationType>}
\DoxyCodeLine{00035\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ TStepperReceiverMeasurementEstimator<SamplingFilmType,\ EstimationType>::}
\DoxyCodeLine{00036\ process(}
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{keyword}{const}\ math::Vector2D\&\ rasterCoord,}
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keyword}{const}\ Ray\&\ \ \ \ \ \ \ \ \ \ \ \ ray,\ }
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{keyword}{const}\ math::Spectrum\&\ quantityWeight,}
\DoxyCodeLine{00040\ \ \ \ \ SampleFlow\&\ \ \ \ \ \ \ \ \ \ \ sampleFlow)}
\DoxyCodeLine{00041\ \{}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keyword}{const}\ \textcolor{keyword}{auto}*\ estimator\ :\ Parent::m\_estimators)}
\DoxyCodeLine{00043\ \ \ \ \ \{}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ estimator-\/>estimate(ray,\ Parent::m\_integrand,\ sampleFlow,\ Parent::m\_estimations);}
\DoxyCodeLine{00045\ \ \ \ \ \}}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ estimationToFilm\ :\ Parent::m\_estimationToFilm)}
\DoxyCodeLine{00048\ \ \ \ \ \{}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::size\_t\ filmIndex\ \ \ \ \ \ \ =\ estimationToFilm.second;}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::size\_t\ estimationIndex\ =\ estimationToFilm.first;}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(m\_currentBatchNumber\ \%\ m\_filmStepSizes[filmIndex]\ ==\ 0)}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ Parent::m\_films[filmIndex].addSample(rasterCoord.x(),\ rasterCoord.y(),\ Parent::m\_estimations[estimationIndex]\ *\ quantityWeight);}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00056\ \ \ \ \ \}}
\DoxyCodeLine{00057\ \}}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ SamplingFilmType,\ \textcolor{keyword}{typename}\ EstimationType>}
\DoxyCodeLine{00060\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ TStepperReceiverMeasurementEstimator<SamplingFilmType,\ EstimationType>::}
\DoxyCodeLine{00061\ setFilmStepSize(}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keyword}{const}\ std::size\_t\ filmIndex,}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keyword}{const}\ std::size\_t\ stepSize)}
\DoxyCodeLine{00064\ \{}
\DoxyCodeLine{00065\ \ \ \ \ PH\_ASSERT\_LT(filmIndex,\ Parent::m\_films.size());}
\DoxyCodeLine{00066\ \ \ \ \ PH\_ASSERT\_GE(stepSize,\ 1);}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \ \ m\_filmStepSizes[filmIndex]\ =\ stepSize;}
\DoxyCodeLine{00069\ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \}\textcolor{comment}{//\ end\ namespace\ ph}}

\end{DoxyCode}
