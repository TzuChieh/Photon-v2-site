\chapter{Scene Description Guide}
\hypertarget{main_scene_description_guide}{}\label{main_scene_description_guide}\index{Scene Description Guide@{Scene Description Guide}}
\label{main_scene_description_guide_md__documentation_2scene__description__guide}%
\Hypertarget{main_scene_description_guide_md__documentation_2scene__description__guide}%


Here, you will learn about the scene description language used in Photon, sometimes referred to as PSDL (Photon Scene Description Language). It is a special format created for storing scene data as well as controlling the behavior of the render engine. We also have \href{https://github.com/TzuChieh/Photon-v2/tree/master/SDLGenerator/SDLGen}{\texttt{ API generators}} for different programming languages, allowing users to programmatically build scene descriptions and output customized formats for various applications. The reference for all engine features exposed as PSDL can be found \doxysectlink{main_scene_description_reference}{here}{0}.\hypertarget{main_scene_description_guide_sdl_introduction}{}\doxysection{\texorpdfstring{Introduction}{Introduction}}\label{main_scene_description_guide_sdl_introduction}
Let us first see how a simple scene would be represented in PSDL. The hello-\/world scene that will be rendered by Photon looks like this

 
\begin{DoxyImage}
\includegraphics[width=\textwidth,height=\textheight/2,keepaspectratio=true]{sdl_hello_world_scene.jpg}
\doxyfigcaption{Rendered hello-\/world scene.}
\end{DoxyImage}
   

This image can be generated by feeding the following descriptions into Photon\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{observer(single-\/lens)\ @observer\ =\ [real\ fov-\/degrees\ 30]\ [vector3\ pos\ \textcolor{stringliteral}{"{}0\ 6\ 40"{}}]\ [vector3\ dir\ \textcolor{stringliteral}{"{}0\ 0\ -\/1"{}}]\ [vector3\ up-\/axis\ \textcolor{stringliteral}{"{}0\ 1\ 0"{}}];}
\DoxyCodeLine{sample-\/source(stratified)\ @sampler\ =\ [integer\ samples\ 10];}
\DoxyCodeLine{visualizer(path-\/tracing)\ @visualizer\ =\ [\textcolor{keyword}{enum}\ sample-\/filter\ gaussian][\textcolor{keyword}{enum}\ estimator\ bneept];}
\DoxyCodeLine{}
\DoxyCodeLine{option(single-\/frame-\/render-\/session)\ @session\ =\ [vector2\ frame-\/size\ \textcolor{stringliteral}{"{}512\ 512"{}}]\ [\textcolor{keywordtype}{string}\ visualizer\ @visualizer]\ [\textcolor{keywordtype}{string}\ observer\ @observer]\ [\textcolor{keywordtype}{string}\ sample-\/source\ @sampler];}
\DoxyCodeLine{}
\DoxyCodeLine{geometry(rectangle)\ @plane\ =\ [real\ width\ 15]\ [real\ height\ 15];}
\DoxyCodeLine{geometry(sphere)\ @ball\ =\ [real\ radius\ 2.5];}
\DoxyCodeLine{image(constant)\ @white\ =\ [real-\/array\ values\ 0.9];}
\DoxyCodeLine{material(matte-\/opaque)\ @diffuse\ =\ [image\ albedo\ @white];}
\DoxyCodeLine{}
\DoxyCodeLine{actor(model)\ @ground\ =\ [geometry\ geometry\ @plane]\ [material\ material\ @diffuse];}
\DoxyCodeLine{actor(model).rotate(@ground)\ =\ [vector3\ axis\ \textcolor{stringliteral}{"{}1\ 0\ 0"{}}]\ [real\ degrees\ -\/90];}
\DoxyCodeLine{actor(model).scale(@ground)\ =\ [vector3\ amount\ \textcolor{stringliteral}{"{}10\ 10\ 10"{}}];}
\DoxyCodeLine{}
\DoxyCodeLine{actor(model)\ @\textcolor{keywordtype}{object}\ =\ [geometry\ geometry\ @ball]\ [material\ material\ @diffuse];}
\DoxyCodeLine{actor(model).translate(@\textcolor{keywordtype}{object})\ =\ [vector3\ amount\ \textcolor{stringliteral}{"{}0\ 2.5\ 0"{}}];}
\DoxyCodeLine{}
\DoxyCodeLine{actor(rectangle-\/light)\ @topLight\ =\ [spectrum\ color\ \textcolor{stringliteral}{"{}1\ 1\ 0.8"{}}]\ [real\ watts\ 400]\ [real\ width\ 2]\ [real\ height\ 2];}
\DoxyCodeLine{actor(light).translate(@topLight)\ =\ [vector3\ amount\ \textcolor{stringliteral}{"{}0\ 10\ 0"{}}];}
\DoxyCodeLine{actor(light).rotate(@topLight)\ =\ [vector3\ axis\ \textcolor{stringliteral}{"{}1\ 0\ 0"{}}]\ [real\ degrees\ 90];}

\end{DoxyCode}


\begin{DoxyNote}{Note}
More example scenes can be found in the \href{https://github.com/TzuChieh/Photon-v2/tree/master/scenes}{\texttt{ ./scenes/}} folder in the \href{https://github.com/TzuChieh/Photon-v2}{\texttt{ Git\+Hub repository}}.
\end{DoxyNote}
Scene descriptions can be stored in a text file (.p2 filename extension) and \textbf{ loaded by Photon for rendering}. Without getting into too much details, the scene description shown above can be summarized as\+:


\begin{DoxyItemize}
\item Declaring a \textbf{ render session}\+:
\begin{DoxyItemize}
\item An "{}observer"{} to view the scene
\item A "{}sampler"{} to provide randomness for numerical integration
\item A "{}visualizer"{} to {\itshape draw} the scene from the observer\textquotesingle{}s point of view
\end{DoxyItemize}
\item Declaring data\+:
\begin{DoxyItemize}
\item A 15 m x 15 m plane
\item A ball with 2.\+5 m radius
\item A white material
\end{DoxyItemize}
\item Placing objects in the scene\+:
\begin{DoxyItemize}
\item We can create a "{}ground"{} object by combining the plane and white material. Photon\textquotesingle{}s default coordinate system is right-\/handed, y-\/up, x-\/right. Since a {\ttfamily rectangle} geometry faces +z by default, a series of transformations are required to place the ground object with the desired rotation and scale.
\item Place a spherical object on the ground
\item Finally, a 400 W rectangular light is placed above the spherical object
\end{DoxyItemize}
\end{DoxyItemize}

After saving the scene description as {\ttfamily hello\+\_\+world.\+p2} under the build/install directory, you can run the following command in the same directory to render the scene as described\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{./bin/PhotonCLI\ -\/s\ ./hello\_world.p2\ -\/t\ 8}

\end{DoxyCode}


\begin{DoxyNote}{Note}
Most components of Photon expect the build/install directory to be their working directory, not the directory that contains the executable.
\end{DoxyNote}
\hypertarget{main_scene_description_guide_autotoc_md58}{}\doxysection{\texorpdfstring{Language Basics}{Language Basics}}\label{main_scene_description_guide_autotoc_md58}
PSDL is a command-\/like system and the commands can be roughly categorized into two parts\+: {\bfseries{header}} and {\bfseries{clause}}. Commands are normally structured in the following way\+:

{\ttfamily type-\/category}({\ttfamily type-\/name}) @{\ttfamily name} = {\ttfamily clauses};

where {\ttfamily =} is the token that separates the header and clauses, which can be naturally interpreted as assigning the RHS clauses into the LHS resource denoted by {\ttfamily name}. For example, to create a unit-\/sized rectangle, we write\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{geometry(rectangle)\ @plane\ =\ [real\ width\ 1]\ [real\ height\ 1];}

\end{DoxyCode}


{\ttfamily geometry(rectangle)} is the full type information for a \textbf{ geometry} resource. By specifying the type name {\ttfamily rectangle} in the parantheses after {\ttfamily geometry}, we are creating a \textbf{ rectangle} geometry named {\ttfamily plane}. Its dimension properties are specified via the two square-\/bracket enclosed clauses that follow the assignment token. In most cases, a clause contains three space-\/separated parts\+: a type, a name and a value. A clause is the most fundamental data block in PSDL, and multiple clauses form a \textbf{ SDL data packet}. In the example of creating a unit-\/sized rectangle, {\ttfamily \mbox{[}real width 1\mbox{]} \mbox{[}real height 1\mbox{]}} is the data packet for initializing the geometry resource named {\ttfamily plane}. Now, the intention of the following line should be quite obvious\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{geometry(sphere)\ @ball\ =\ [real\ radius\ 2.5];}

\end{DoxyCode}


It creates a geometry resource named {\ttfamily ball}, which is a \textbf{ sphere} with {\ttfamily radius = 2.\+5}. We will dive further into the topics of type and clause later.

As you may have noticed, all commands end with a trailing semi-\/colon. To disable a command or write a comment, simply put two slashes before the line\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ These\ commands\ are\ being\ disabled}}
\DoxyCodeLine{\textcolor{comment}{//sample-\/source(stratified)\ @sampler\ =\ [integer\ samples\ 10];}}
\DoxyCodeLine{\textcolor{comment}{//actor(model).scale(@ground)\ =\ [vector3\ amount\ "{}10\ 10\ 10"{}];}}

\end{DoxyCode}


\begin{DoxyNote}{Note}
As long as you do not break any keyword or symbol of PSDL, a single command can be dissected into multiple lines. Cramming multiple commands into a single line is also supported.
\end{DoxyNote}
In the next sections, we will formally introduce the syntactic structures of PSDL commands.\hypertarget{main_scene_description_guide_autotoc_md59}{}\doxysubsection{\texorpdfstring{Type Category}{Type Category}}\label{main_scene_description_guide_autotoc_md59}
{\ttfamily type-\/category}(type-\/name) @name = clauses;

Describes the category to which the current command belongs. For example, the command that creates a geometry states that its category is {\ttfamily geometry} in its type category section. There are many categories in PSDL. In addition to the ones seen in the above hello-\/world scene description, we also have {\ttfamily image}, {\ttfamily object} and much more.\hypertarget{main_scene_description_guide_autotoc_md60}{}\doxysubsection{\texorpdfstring{Type Name}{Type Name}}\label{main_scene_description_guide_autotoc_md60}
type-\/category({\ttfamily type-\/name}) @name = clauses;

Type names generally {\itshape add details} to the type category. Again, in the command that creates a geometry, we know that we are now creating a {\ttfamily rectangle} geometry from the command fragment {\ttfamily geometry(rectangle)}. Type category and type name are often combined and are called {\bfseries{full type name}} together. Full type name is only needed if the underlying engine operation requires it (such as creating a resource). For executor calls (see the later section), type name can be omitted (will be automatically deduced from the referenced resource) sometimes.\hypertarget{main_scene_description_guide_autotoc_md61}{}\doxysubsection{\texorpdfstring{Data Name}{Data Name}}\label{main_scene_description_guide_autotoc_md61}
type-\/category(type-\/name) @{\ttfamily name} = clauses;

The data name is the name given to the command (e.\+g., as a resource name, or a reference name) and is always prefixed by {\ttfamily @}. Note that {\ttfamily @} is part of the syntax rather than part of the name. Also, names with whitespace characters should be enclosed by double quotes, see the following example to understand more clearly\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ @\ is\ part\ of\ the\ syntax\ and\ should\ be\ left\ out\ of\ the\ double\ quotes.\ In\ this}}
\DoxyCodeLine{\textcolor{comment}{//\ example,\ we\ created\ a\ sphere\ named\ "{}ball\ name\ with\ spaces"{}.}}
\DoxyCodeLine{geometry(sphere)\ \textcolor{stringliteral}{@"{}ball\ name\ with\ spaces"{}}\ =\ [real\ radius\ 2.5];}
\DoxyCodeLine{actor(model)\ @balloon\ =\ [geometry\ geometry\ \textcolor{stringliteral}{@"{}ball\ name\ with\ spaces"{}}];}

\end{DoxyCode}
\hypertarget{main_scene_description_guide_sdl_clauses}{}\doxysection{\texorpdfstring{Clauses}{Clauses}}\label{main_scene_description_guide_sdl_clauses}
type-\/category(type-\/name) @name = {\ttfamily clauses};

Clause is a structure that stores parameters for a command. It has the following form\+:

\mbox{[}{\ttfamily type-\/category} {\ttfamily parameter-\/name}\+:{\ttfamily tag} {\ttfamily values}\mbox{]}

It is worth pointing out that the {\ttfamily parameter-\/name} does not need to start with {\ttfamily @}. The {\ttfamily values} section can have many forms such as numerical values (as seen earlier), arrays, and even stand-\/alone data files (we call them {\bfseries{PSDL Resource Identifier}}). Details for resource identifiers will be introduced in \doxysectlink{main_scene_description_guide_psdl_resource_identifier}{later part}{1} of the guide.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ By\ writing\ these,\ we\ now\ added\ a\ plane,\ a\ ball\ and\ a\ material\ to\ the\ scene!}}
\DoxyCodeLine{\textcolor{comment}{//\ At\ this\ stage,\ they\ are\ like\ props\ and\ are\ not\ visible.\ They\ still\ need}}
\DoxyCodeLine{\textcolor{comment}{//\ actors\ to\ show\ up\ in\ the\ rendered\ scene.}}
\DoxyCodeLine{geometry(rectangle)\ \ \ \ @plane\ \ \ =\ [real\ width\ 15]\ [real\ height\ 15];}
\DoxyCodeLine{geometry(sphere)\ \ \ \ \ \ \ @ball\ \ \ \ =\ [real\ radius\ 2.5];}
\DoxyCodeLine{image(constant)\ \ \ \ \ \ \ \ @white\ \ \ =\ [real-\/array\ values\ 0.9];}
\DoxyCodeLine{material(matte-\/opaque)\ @diffuse\ =\ [image\ albedo\ @white];}

\end{DoxyCode}


When defining a clause, {\ttfamily type-\/category} can be classified into {\itshape value} and {\itshape reference}. \doxysectlink{main_scene_description_guide_sdl_value_types}{Value types}{2} do not share data and create a new block of data each time a clause is instantiated. On the other hand, \doxysectlink{main_scene_description_guide_sdl_reference_types}{reference types}{2} can share their data by instance names, with automatic reference counting.\hypertarget{main_scene_description_guide_sdl_value_types}{}\doxysubsection{\texorpdfstring{Value Types}{Value Types}}\label{main_scene_description_guide_sdl_value_types}
These are common value types\texorpdfstring{$\ast$}{*} used in a SDL clause\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Type   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Value Syntax   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Notes    }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Type   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Value Syntax   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Notes    }\\\cline{1-3}
\endhead
{\ttfamily integer}   &An optionally double-\/quoted single integer literal. {\ttfamily 42}, {\ttfamily "{}6789"{}} are all valid inputs. Hexadecimal input like {\ttfamily 0x\+FF} is also supported.   &Internally, the clause may bind to a lower precision field such as {\ttfamily uin16}. Incompatible value literals will be detected and reported.\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}    \\\cline{1-3}
{\ttfamily real}   &An optionally double-\/quoted single floating-\/point literal. {\ttfamily -\/123}, {\ttfamily "{}3.\+1415926"{}} are all valid literals.   &Internally, the clause may bind to a field with a type different from {\ttfamily float}. Incompatible value literals will be detected and reported.\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}    \\\cline{1-3}
{\ttfamily bool}   &{\ttfamily true}, {\ttfamily True}, or {\ttfamily TRUE} for true; {\ttfamily false}, {\ttfamily False}, or {\ttfamily FALSE} for false.   &\\\cline{1-3}
{\ttfamily string}   &A string without whitespaces can be specified directly like {\ttfamily nospace}. Whitespaces like spaces, tabs, etc. can be included using double quotes like {\ttfamily "{}  lots of  spaces  "{}}.   &\\\cline{1-3}
{\ttfamily vector2}   &Two floating-\/point literals enclosed by a pair of double quotes. The literals should be separated by whitespace(s) like {\ttfamily "{}-\/1.\+2 3.\+4"{}}. If only a single literal is provided, it will be applied to all components. For example, {\ttfamily 0.\+5} is equivalent to {\ttfamily "{}0.\+5 0.\+5"{}}.   &\\\cline{1-3}
{\ttfamily vector3}   &Similar to {\ttfamily vector2}, except that three literals are allowed.   &\\\cline{1-3}
{\ttfamily vector4}   &Similar to {\ttfamily vector3}, except that four literals are allowed.   &\\\cline{1-3}
{\ttfamily quaternion}   &Exactly the same as {\ttfamily vector4}.   &This type represents a quaternion. For vectors or tuples, use {\ttfamily vector4}.    \\\cline{1-3}
{\ttfamily real-\/array}   &Array variant of {\ttfamily real} that can accept N (N \texorpdfstring{$>$}{>}= 0) floating-\/point literals. All literals are separated by whitespace(s) and should be enclosed by curly braces. For example, an increasing series of 5 elements can be written as {\ttfamily \{1.\+1 2.\+2 3.\+3 4.\+4 5.\+5\}}.   &Accepts \doxysectlink{main_scene_description_guide_psdl_resource_identifier}{resource identifier}{1} as input. In this case, it is expected to be a file that contains the value part of the clause.    \\\cline{1-3}
{\ttfamily vector3-\/array}   &Array variant of {\ttfamily vector3} that can accept N (N \texorpdfstring{$>$}{>}= 0) {\ttfamily vector3} values. For example, {\ttfamily \{"{}7 7 7"{} "{}7"{}\}} defines two {\ttfamily vector3} values, where all components == 7.   &\\\cline{1-3}
{\ttfamily path}   &Basically a {\ttfamily string}, except that its value is interpreted as a filesystem path.   &It is recommended to use \doxysectlink{main_scene_description_guide_psdl_resource_identifier}{resource identifier}{1} where possible so the scene file can be easily distributed without broken links.    \\\cline{1-3}
{\ttfamily enum}   &A {\ttfamily string} that identifies an enumeration entry.   &See the \doxysectlink{main_scene_description_reference}{scene description reference}{0} for valid enumeration identifiers.   \\\cline{1-3}
\end{longtabu}


All values can be double-\/quoted unless otherwise noted.

\texorpdfstring{$\ast$}{*}\+: Value types do not have {\ttfamily type-\/name}. The types shown here are both being full type names and type categories. \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}\+: Depending on the settings of the bound field and the parser, such warnings/errors may be disabled.\hypertarget{main_scene_description_guide_sdl_reference_types}{}\doxysubsection{\texorpdfstring{Reference Types}{Reference Types}}\label{main_scene_description_guide_sdl_reference_types}
Each command from the example in the \doxysectlink{main_scene_description_guide_sdl_introduction}{introduction section}{1} creates a named reference (if there is a {\ttfamily @} specifier\texorpdfstring{$\ast$}{*} before the name). Consider the following command that creates a rectangle\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{geometry(rectangle)\ @plane\ =\ [real\ width\ 15]\ [real\ height\ 15];}

\end{DoxyCode}


The reference {\ttfamily @plane} will uniquely identify the geometry resource, which is a rectangle, that has been created by the command. Many types in PSDL accept references as input. In this case, we use the {\ttfamily type-\/category} and a corresponding reference in the \doxysectlink{main_scene_description_guide_sdl_clauses}{clause definition}{1}. For example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{image(constant)\ @white\ =\ [real-\/array\ values\ 0.9];}
\DoxyCodeLine{material(matte-\/opaque)\ @diffuse\ =\ [image\ albedo\ @white];}

\end{DoxyCode}


A material resource named {\ttfamily diffuse} is being created by referencing an image named {\ttfamily white} as its albedo with the clause {\ttfamily \mbox{[}image albedo @white\mbox{]}}. Note that references can be used for resource sharing. For example, another diffuse material {\ttfamily diffuse2} can be created with the same clause (referencing {\ttfamily white}) and both {\ttfamily diffuse} and {\ttfamily diffuse2} will be using the same piece of data for their albedo.

\texorpdfstring{$\ast$}{*}\+: We call this a {\itshape persistent specifier}. The named target will be persistent throughout the lifetime of the containing scene.\hypertarget{main_scene_description_guide_autotoc_md62}{}\doxysubsection{\texorpdfstring{Struct Types}{Struct Types}}\label{main_scene_description_guide_autotoc_md62}
With PSDL, you can create almost all kinds of objects the rendering system has to offer. In later sections, we will see that it is also possible to perform \doxysectlink{main_scene_description_guide_operations}{operations}{1} on these objects via PSDL.\hypertarget{main_scene_description_guide_operations}{}\doxysection{\texorpdfstring{Operations}{Operations}}\label{main_scene_description_guide_operations}
\begin{DoxyRemark}{Remarks}
Go back and check the hello-\/world scene description again. You should be able to understand most of the lines now.
\end{DoxyRemark}
\hypertarget{main_scene_description_guide_psdl_resource_identifier}{}\doxysection{\texorpdfstring{PSDL Resource Identifier}{PSDL Resource Identifier}}\label{main_scene_description_guide_psdl_resource_identifier}
\hypertarget{main_scene_description_guide_autotoc_md63}{}\doxysection{\texorpdfstring{C++ Binding}{C++ Binding}}\label{main_scene_description_guide_autotoc_md63}
\hypertarget{main_scene_description_guide_autotoc_md64}{}\doxysubsection{\texorpdfstring{Owner Types}{Owner Types}}\label{main_scene_description_guide_autotoc_md64}
\hypertarget{main_scene_description_guide_autotoc_md65}{}\doxysubsection{\texorpdfstring{Struct Types}{Struct Types}}\label{main_scene_description_guide_autotoc_md65}
\hypertarget{main_scene_description_guide_autotoc_md66}{}\doxysubsection{\texorpdfstring{Enum Types}{Enum Types}}\label{main_scene_description_guide_autotoc_md66}
\hypertarget{main_scene_description_guide_autotoc_md67}{}\doxysubsection{\texorpdfstring{Field Types}{Field Types}}\label{main_scene_description_guide_autotoc_md67}
\hypertarget{main_scene_description_guide_autotoc_md68}{}\doxysubsection{\texorpdfstring{Function Types}{Function Types}}\label{main_scene_description_guide_autotoc_md68}
\hypertarget{main_scene_description_guide_autotoc_md69}{}\doxysection{\texorpdfstring{Serialization}{Serialization}}\label{main_scene_description_guide_autotoc_md69}
\hypertarget{main_scene_description_guide_autotoc_md70}{}\doxysection{\texorpdfstring{Appendix}{Appendix}}\label{main_scene_description_guide_autotoc_md70}
\doxysectlink{main_scene_description_reference}{Full documentation of PSDL commands}{0}. 